"use strict";(self.webpackChunkdocs_web=self.webpackChunkdocs_web||[]).push([[304],{2710:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"backend/middleware/upload","title":"Middleware upload","description":"Este middleware configura la subida de archivos (im\xe1genes) al servicio en la nube Cloudinary, utilizando multer como middleware para gestionar los archivos desde el cliente.","source":"@site/docs/backend/middleware/upload.md","sourceDirName":"backend/middleware","slug":"/backend/middleware/upload","permalink":"/docs/backend/middleware/upload","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/backend/middleware/upload.md","tags":[],"version":"current","frontMatter":{"id":"upload","title":"Middleware upload","sidebar_label":"Upload"},"sidebar":"tutorialSidebar","previous":{"title":"Token","permalink":"/docs/backend/middleware/token.middleware"},"next":{"title":"Servicios de Productos","permalink":"/docs/backend/services/productos-service"}}');var i=r(4848),d=r(8453);const s={id:"upload",title:"Middleware upload",sidebar_label:"Upload"},l="Middleware: upload.ts",o={},t=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udccc Prop\xf3sito",id:"-prop\xf3sito",level:2},{value:"\ud83d\udee0 Dependencias utilizadas",id:"-dependencias-utilizadas",level:2},{value:"\ud83d\udd10 Variables de entorno requeridas",id:"-variables-de-entorno-requeridas",level:2},{value:"\ud83d\udce6 Configuraci\xf3n de almacenamiento",id:"-configuraci\xf3n-de-almacenamiento",level:2},{value:"\ud83e\udde9 Exportaci\xf3n del middleware",id:"-exportaci\xf3n-del-middleware",level:2},{value:"\u2705 Ejemplo de uso en rutas",id:"-ejemplo-de-uso-en-rutas",level:2},{value:"\ud83d\udce4 Resumen",id:"-resumen",level:2},{value:"\ud83d\udd0d Notas adicionales",id:"-notas-adicionales",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"middleware-uploadts",children:"Middleware: upload.ts"})}),"\n",(0,i.jsxs)(n.p,{children:["Este middleware configura ",(0,i.jsx)(n.em,{children:"la subida de archivos (im\xe1genes)"})," al servicio en la nube ",(0,i.jsx)(n.em,{children:"Cloudinary"}),", utilizando multer como middleware para gestionar los archivos desde el cliente."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"src/middleware/upload.ts"})}),"\n",(0,i.jsx)(n.h2,{id:"-prop\xf3sito",children:"\ud83d\udccc Prop\xf3sito"}),"\n",(0,i.jsx)(n.p,{children:"Permitir que los usuarios suban im\xe1genes (por ejemplo, fotos de perfil) que se almacenar\xe1n en Cloudinary. Esto se integra f\xe1cilmente con rutas protegidas en el backend y garantiza un manejo eficiente de archivos."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-dependencias-utilizadas",children:"\ud83d\udee0 Dependencias utilizadas"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { v2 as cloudinary } from 'cloudinary';\r\nimport { CloudinaryStorage } from 'multer-storage-cloudinary';\r\nimport multer from 'multer';\r\nimport dotenv from 'dotenv';\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"cloudinary"}),": Cliente de la API de Cloudinary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"CloudinaryStorage"}),": Adaptador de almacenamiento para multer que conecta con Cloudinary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"multer"}),": Middleware para manejar multipart/form-data, utilizado para la subida de archivos."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"dotenv"}),": Para cargar variables de entorno desde .env."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-variables-de-entorno-requeridas",children:"\ud83d\udd10 Variables de entorno requeridas"}),"\n",(0,i.jsx)(n.p,{children:"Este middleware requiere que existan las siguientes variables definidas en el archivo .env:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-env",children:"CLOUDINARY_NAME=<tu_nombre_en_cloudinary>\r\nCLOUDINARY_API_KEY=<tu_api_key>\r\nCLOUDINARY_API_SECRET=<tu_api_secret>\r\n\r\n\r\nEstas credenciales son necesarias para autenticar el uso de Cloudinary.\r\n\r\n---\r\n\r\n## \u2601 Configuraci\xf3n de Cloudinary\r\n\r\n```ts\r\ncloudinary.config({\r\n    cloud_name: process.env.CLOUDINARY_NAME,\r\n    api_key: process.env.CLOUDINARY_API_KEY,\r\n    api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-configuraci\xf3n-de-almacenamiento",children:"\ud83d\udce6 Configuraci\xf3n de almacenamiento"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const storage = new CloudinaryStorage({\r\n    cloudinary: cloudinary,\r\n    params: {\r\n        folder: 'producttrack/perfiles',\r\n        allowed_formats: ['jpg', 'png', 'jpeg', 'webp'],\r\n        transformation: [{ width: 500, height: 500, crop: 'limit' }],\r\n    } as any,\r\n});\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"folder"}),": Las im\xe1genes se guardan en la carpeta producttrack/perfiles en Cloudinary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"allowed_formats"}),": Solo se permiten im\xe1genes en formatos jpg, png, jpeg y webp."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"transformation"}),": Las im\xe1genes se ajustan a un m\xe1ximo de 500x500 p\xedxeles, manteniendo su proporci\xf3n (crop: 'limit')."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-exportaci\xf3n-del-middleware",children:"\ud83e\udde9 Exportaci\xf3n del middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"export const upload = multer({ storage });\n"})}),"\n",(0,i.jsx)(n.p,{children:"Esto permite utilizar upload como middleware en rutas para manejar archivos subidos."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ejemplo-de-uso-en-rutas",children:"\u2705 Ejemplo de uso en rutas"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { upload } from "../middleware/upload";\r\n\r\nrouter.post("/perfil/foto", upload.single("imagen"), controlador.subirFoto);\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'El campo "imagen" debe coincidir con el nombre del campo en el formulario HTML o frontend.'}),"\n",(0,i.jsx)(n.li,{children:"Se puede utilizar .single(), .array(), o .fields() seg\xfan el tipo de carga."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-resumen",children:"\ud83d\udce4 Resumen"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Elemento"}),(0,i.jsx)(n.th,{children:"Valor"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Almacenamiento"}),(0,i.jsx)(n.td,{children:"Cloudinary (producttrack/perfiles)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Middleware de subida"}),(0,i.jsx)(n.td,{children:"multer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Archivos permitidos"}),(0,i.jsx)(n.td,{children:".jpg, .png, .jpeg, .webp"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Transformaci\xf3n"}),(0,i.jsx)(n.td,{children:"M\xe1ximo 500x500 px, sin recorte forzado"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-notas-adicionales",children:"\ud83d\udd0d Notas adicionales"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No es necesario crear manualmente la carpeta en Cloudinary."}),"\n",(0,i.jsx)(n.li,{children:"Las im\xe1genes pueden ser accedidas luego con las URLs p\xfablicas generadas por Cloudinary."}),"\n",(0,i.jsx)(n.li,{children:"Este middleware es ideal para manejar fotos de perfil, logos de empresa u otros recursos visuales."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var a=r(6540);const i={},d=a.createContext(i);function s(e){const n=a.useContext(d);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(d.Provider,{value:n},e.children)}}}]);