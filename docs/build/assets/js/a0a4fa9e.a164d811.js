"use strict";(self.webpackChunkdocs_web=self.webpackChunkdocs_web||[]).push([[266],{7925:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"backend/middleware/token.middleware","title":"Middleware de token","description":"Este middleware se encarga de verificar y autenticar el token JWT enviado por el cliente en las cabeceras de la solicitud. Si el token es v\xe1lido, extrae la informaci\xf3n del usuario y la adjunta al objeto req para su uso en otros middlewares o controladores.","source":"@site/docs/backend/middleware/token.middleware.md","sourceDirName":"backend/middleware","slug":"/backend/middleware/token.middleware","permalink":"/docs/backend/middleware/token.middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/backend/middleware/token.middleware.md","tags":[],"version":"current","frontMatter":{"id":"token.middleware","title":"Middleware de token","sidebar_label":"Token"},"sidebar":"tutorialSidebar","previous":{"title":"Roles","permalink":"/docs/backend/middleware/roles.middleware"},"next":{"title":"Upload","permalink":"/docs/backend/middleware/upload"}}');var d=r(4848),a=r(8453);const s={id:"token.middleware",title:"Middleware de token",sidebar_label:"Token"},l="\ud83d\udee1\ufe0f Middleware: token.middleware.ts",o={},t=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udccc Prop\xf3sito",id:"-prop\xf3sito",level:2},{value:"\ud83d\udce5 Importaciones",id:"-importaciones",level:2},{value:"\ud83e\udde0 Tipado extendido",id:"-tipado-extendido",level:2},{value:"\ud83d\udea6 Middleware principal",id:"-middleware-principal",level:2},{value:"Descripci\xf3n del flujo",id:"descripci\xf3n-del-flujo",level:3},{value:"\u2705 Ejemplo de uso",id:"-ejemplo-de-uso",level:2},{value:"\ud83d\udce4 Cabecera esperada",id:"-cabecera-esperada",level:2},{value:"\u26a0 Respuestas de error posibles",id:"-respuestas-de-error-posibles",level:2},{value:"\ud83e\udde9 Dependencias",id:"-dependencias",level:2},{value:"\ud83e\uddea Notas t\xe9cnicas",id:"-notas-t\xe9cnicas",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"\ufe0f-middleware-tokenmiddlewarets",children:"\ud83d\udee1\ufe0f Middleware: token.middleware.ts"})}),"\n",(0,d.jsxs)(n.p,{children:["Este middleware se encarga de ",(0,d.jsx)(n.em,{children:"verificar y autenticar el token JWT"})," enviado por el cliente en las cabeceras de la solicitud. Si el token es v\xe1lido, extrae la informaci\xf3n del usuario y la adjunta al objeto ",(0,d.jsx)(n.code,{children:"req"})," para su uso en otros middlewares o controladores."]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.code,{children:"src/middleware/token.middleware.ts"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-prop\xf3sito",children:"\ud83d\udccc Prop\xf3sito"}),"\n",(0,d.jsxs)(n.p,{children:["Proteger rutas que requieren autenticaci\xf3n validando el token JWT. Si el token es v\xe1lido, el usuario autenticado se a\xf1ade al request (",(0,d.jsx)(n.code,{children:"req.user"}),")."]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-importaciones",children:"\ud83d\udce5 Importaciones"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'import { Request, Response, NextFunction } from "express";\r\nimport { verificarToken } from "../services/token.service";\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"verificarToken: funci\xf3n importada desde token.service.ts que valida y decodifica el token JWT."}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-tipado-extendido",children:"\ud83e\udde0 Tipado extendido"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export interface AuthenticatedRequest extends Request {\r\n  user?: any;\r\n}\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Se extiende la interfaz Request de Express para incluir un campo user, donde se almacena la informaci\xf3n del usuario extra\xedda del token."}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-middleware-principal",children:"\ud83d\udea6 Middleware principal"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export function autenticarToken(req: AuthenticatedRequest, res: Response, next: NextFunction)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"descripci\xf3n-del-flujo",children:"Descripci\xf3n del flujo"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"Se extrae el token desde el encabezado Authorization, en formato Bearer [token]."}),"\n",(0,d.jsx)(n.li,{children:"Si no hay token, se responde con error 401."}),"\n",(0,d.jsx)(n.li,{children:"Si hay token, se verifica mediante verificarToken(token)."}),"\n",(0,d.jsx)(n.li,{children:"Si el token es v\xe1lido, la informaci\xf3n del usuario se guarda en req.user."}),"\n",(0,d.jsx)(n.li,{children:"Si el token es inv\xe1lido o ha expirado, se responde con error 403."}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-ejemplo-de-uso",children:"\u2705 Ejemplo de uso"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'import { autenticarToken } from "../middleware/token.middleware";\r\n\r\nrouter.get("/perfil", autenticarToken, perfilController.obtenerPerfil);\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-cabecera-esperada",children:"\ud83d\udce4 Cabecera esperada"}),"\n",(0,d.jsx)(n.p,{children:"http\r\nAuthorization: Bearer [token JWT]"}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-respuestas-de-error-posibles",children:"\u26a0 Respuestas de error posibles"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"C\xf3digo"}),(0,d.jsx)(n.th,{children:"Mensaje"}),(0,d.jsx)(n.th,{children:"Situaci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"401"}),(0,d.jsx)(n.td,{children:'"Token no proporcionado"'}),(0,d.jsx)(n.td,{children:"No se envi\xf3 un token en la cabecera."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"403"}),(0,d.jsx)(n.td,{children:'"Token inv\xe1lido o expirado"'}),(0,d.jsx)(n.td,{children:"El token es inv\xe1lido o ha expirado."})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-dependencias",children:"\ud83e\udde9 Dependencias"}),"\n",(0,d.jsx)(n.p,{children:"Este middleware depende de:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"token.service.ts \u2192 funci\xf3n verificarToken(token: string): any"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"-notas-t\xe9cnicas",children:"\ud83e\uddea Notas t\xe9cnicas"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"El campo req.user es utilizado por otros middlewares como roles.middleware.ts para controlar permisos."}),"\n",(0,d.jsx)(n.li,{children:"Este middleware debe colocarse antes de cualquier middleware o controlador que requiera informaci\xf3n del usuario autenticado."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var i=r(6540);const d={},a=i.createContext(d);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);