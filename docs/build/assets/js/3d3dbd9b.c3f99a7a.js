"use strict";(self.webpackChunkdocs_web=self.webpackChunkdocs_web||[]).push([[452],{1825:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>n,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"backend/middleware/roles.middleware","title":"Middleware de roles","description":"Este middleware permite restringir el acceso a rutas bas\xe1ndose en el rol principal del usuario (user.rol) y, opcionalmente, en su rol dentro de un equipo (user.rolEquipo). Tambi\xe9n permite verificar si el usuario pertenece al tipo EMPRESARIAL.","source":"@site/docs/backend/middleware/roles.middleware.md","sourceDirName":"backend/middleware","slug":"/backend/middleware/roles.middleware","permalink":"/docs/backend/middleware/roles.middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/backend/middleware/roles.middleware.md","tags":[],"version":"current","frontMatter":{"id":"roles.middleware","title":"Middleware de roles","sidebar_label":"Roles"},"sidebar":"tutorialSidebar","previous":{"title":"Log Interface","permalink":"/docs/backend/interfaces/log.interface"},"next":{"title":"Token","permalink":"/docs/backend/middleware/token.middleware"}}');var d=i(4848),l=i(8453);const n={id:"roles.middleware",title:"Middleware de roles",sidebar_label:"Roles"},o="Middleware: roles.middleware.ts",a={},t=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udccc Prop\xf3sito",id:"-prop\xf3sito",level:2},{value:"\ud83d\udce5 Importaciones",id:"-importaciones",level:2},{value:"\ud83e\udde0 Firma del middleware",id:"-firma-del-middleware",level:2},{value:"Par\xe1metros",id:"par\xe1metros",level:3},{value:"\u2705 Ejemplo de uso",id:"-ejemplo-de-uso",level:2},{value:"\u26a0 Respuestas de error posibles",id:"-respuestas-de-error-posibles",level:2},{value:"\ud83e\uddea Flujo de ejecuci\xf3n",id:"-flujo-de-ejecuci\xf3n",level:2},{value:"\ud83e\udde9 Dependencias",id:"-dependencias",level:2}];function c(e){const r={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.header,{children:(0,d.jsx)(r.h1,{id:"middleware-rolesmiddlewarets",children:"Middleware: roles.middleware.ts"})}),"\n",(0,d.jsxs)(r.p,{children:["Este middleware permite restringir el acceso a rutas bas\xe1ndose en el ",(0,d.jsx)(r.em,{children:"rol principal del usuario"})," (user.rol) y, opcionalmente, en su ",(0,d.jsx)(r.em,{children:"rol dentro de un equipo"})," (user.rolEquipo). Tambi\xe9n permite verificar si el usuario pertenece al tipo EMPRESARIAL."]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,d.jsx)(r.p,{children:(0,d.jsx)(r.code,{children:"src/middleware/roles.middleware.ts"})}),"\n",(0,d.jsx)(r.h2,{id:"-prop\xf3sito",children:"\ud83d\udccc Prop\xf3sito"}),"\n",(0,d.jsx)(r.p,{children:"Limitar el acceso a ciertas rutas a:"}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"Usuarios con roles espec\xedficos (ej. ADMIN, EMPRESARIAL, EQUIPO, etc.)"}),"\n",(0,d.jsx)(r.li,{children:"Usuarios de tipo empresarial, si se requiere"}),"\n",(0,d.jsx)(r.li,{children:"Usuarios de equipo con roles espec\xedficos dentro del equipo (opcional)"}),"\n"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-importaciones",children:"\ud83d\udce5 Importaciones"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-ts",children:'import { Response, NextFunction } from "express";\r\nimport { AuthenticatedRequest } from "./token.middleware";\n'})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"AuthenticatedRequest es una extensi\xf3n de Request que incluye la propiedad user, a\xf1adida previamente por el middleware de autenticaci\xf3n (token.middleware)."}),"\n"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-firma-del-middleware",children:"\ud83e\udde0 Firma del middleware"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-ts",children:"permitirRolesYRolEquipo(\r\n  rolesPermitidos: string[],\r\n  rolesEquipoPermitidos?: string[],\r\n  requiereTipoEmpresarial = false\r\n)\n"})}),"\n",(0,d.jsx)(r.h3,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Par\xe1metro"}),(0,d.jsx)(r.th,{children:"Tipo"}),(0,d.jsx)(r.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"rolesPermitidos"}),(0,d.jsx)(r.td,{children:"string[]"}),(0,d.jsx)(r.td,{children:"Lista de roles principales autorizados para acceder a la ruta."})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"rolesEquipoPermitidos"}),(0,d.jsx)(r.td,{children:"string[]?"}),(0,d.jsx)(r.td,{children:"(Opcional) Lista de roles v\xe1lidos para usuarios del tipo EQUIPO."})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"requiereTipoEmpresarial"}),(0,d.jsx)(r.td,{children:"boolean"}),(0,d.jsx)(r.td,{children:"(Opcional) Si se requiere que el usuario sea del tipo EMPRESARIAL. Por defecto es false."})]})]})]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-ejemplo-de-uso",children:"\u2705 Ejemplo de uso"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-ts",children:'import { permitirRolesYRolEquipo } from "../middleware/roles.middleware";\r\n\r\n// Solo ADMIN y EMPRESARIAL pueden acceder\r\nrouter.post(\r\n  "/crear-usuario",\r\n  permitirRolesYRolEquipo(["ADMIN", "EMPRESARIAL"], ["editor", "admin"], true),\r\n  controlador.crearUsuario\r\n);\n'})}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-respuestas-de-error-posibles",children:"\u26a0 Respuestas de error posibles"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"C\xf3digo"}),(0,d.jsx)(r.th,{children:"Mensaje"}),(0,d.jsx)(r.th,{children:"Situaci\xf3n"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"403"}),(0,d.jsx)(r.td,{children:'"Acceso no autorizado"'}),(0,d.jsx)(r.td,{children:"No hay informaci\xf3n del usuario en la petici\xf3n."})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"403"}),(0,d.jsx)(r.td,{children:'"Rol no permitido"'}),(0,d.jsx)(r.td,{children:"El user.rol no est\xe1 en la lista de roles permitidos."})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"403"}),(0,d.jsx)(r.td,{children:'"Acceso denegado. Solo las empresas..."'}),(0,d.jsx)(r.td,{children:"El usuario no es del tipo EMPRESARIAL y se requiere."})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"403"}),(0,d.jsx)(r.td,{children:'"Rol de equipo no permitido"'}),(0,d.jsx)(r.td,{children:"El user.rol es EQUIPO, pero no tiene el rol dentro del equipo adecuado."})]})]})]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-flujo-de-ejecuci\xf3n",children:"\ud83e\uddea Flujo de ejecuci\xf3n"}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsx)(r.li,{children:"Se verifica que req.user exista."}),"\n",(0,d.jsx)(r.li,{children:"Se valida si el rol principal (user.rol) est\xe1 permitido."}),"\n",(0,d.jsx)(r.li,{children:"Si se requiere, se valida que el tipoUsuario sea EMPRESARIAL."}),"\n",(0,d.jsx)(r.li,{children:"Si el rol es EQUIPO, se valida que tenga un rolEquipo autorizado."}),"\n",(0,d.jsx)(r.li,{children:"Si todo es v\xe1lido, se ejecuta next() para continuar con la siguiente funci\xf3n en la ruta."}),"\n"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-dependencias",children:"\ud83e\udde9 Dependencias"}),"\n",(0,d.jsx)(r.p,{children:"Este middleware depende del middleware de autenticaci\xf3n que a\xf1ade req.user, generalmente implementado en:"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-ts",children:"token.middleware.ts\n"})})]})}function u(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},8453:(e,r,i)=>{i.d(r,{R:()=>n,x:()=>o});var s=i(6540);const d={},l=s.createContext(d);function n(e){const r=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:n(e.components),s.createElement(l.Provider,{value:r},e.children)}}}]);