"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5412],{6919:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"backend/services/user.service","title":"Servicio de Usuarios","description":"Este servicio gestiona todas las operaciones relacionadas con usuarios, incluyendo creaci\xf3n, consulta, actualizaci\xf3n, eliminaci\xf3n, reactivaci\xf3n, cambio de contrase\xf1a y manejo de empresas.","source":"@site/docs/backend/services/user.service.md","sourceDirName":"backend/services","slug":"/backend/services/user.service","permalink":"/producttrack/docs/backend/services/user.service","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/services/user.service.md","tags":[],"version":"current","frontMatter":{"id":"user.service","title":"Servicio de Usuarios","sidebar_label":"User Service"},"sidebar":"tutorialSidebar","previous":{"title":"Token","permalink":"/producttrack/docs/backend/services/token.service"},"next":{"title":"Sincronizar Recordatorios","permalink":"/producttrack/docs/backend/sincronizarRecordatorios"}}');var i=s(4848),d=s(8453);const c={id:"user.service",title:"Servicio de Usuarios",sidebar_label:"User Service"},a=void 0,o={},l=[{value:"\ud83d\udccd Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udce6 Dependencias",id:"-dependencias",level:2},{value:"\ud83d\udd11 Variables de Entorno",id:"-variables-de-entorno",level:2},{value:"\ud83d\udcdc Funciones",id:"-funciones",level:2},{value:"1. <code>getAllUsers(filters: Partial&lt;UserDTO&gt;)</code>",id:"1-getallusersfilters-partialuserdto",level:3},{value:"2. <code>getUserById(id: number)</code>",id:"2-getuserbyidid-number",level:3},{value:"3. <code>createUser(data: UserDTO)</code>",id:"3-createuserdata-userdto",level:3},{value:"4. <code>getEmpresaById(id: number)</code>",id:"4-getempresabyidid-number",level:3},{value:"5. <code>updateUser(id: number, data: Partial&lt;UserDTO&gt;)</code>",id:"5-updateuserid-number-data-partialuserdto",level:3},{value:"6. <code>changeUserPassword(id: number, currentPassword: string, newPassword: string)</code>",id:"6-changeuserpasswordid-number-currentpassword-string-newpassword-string",level:3},{value:"7. <code>reactivarUsuario(id: number)</code>",id:"7-reactivarusuarioid-number",level:3},{value:"8. <code>deleteUser(id: number)</code>",id:"8-deleteuserid-number",level:3},{value:"\ud83e\udde0 Observaciones",id:"-observaciones",level:2}];function t(e){const r={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.p,{children:["Este servicio gestiona todas las operaciones relacionadas con ",(0,i.jsx)(r.strong,{children:"usuarios"}),", incluyendo creaci\xf3n, consulta, actualizaci\xf3n, eliminaci\xf3n, reactivaci\xf3n, cambio de contrase\xf1a y manejo de empresas.",(0,i.jsx)(r.br,{}),"\n","Incluye adem\xe1s la generaci\xf3n de ",(0,i.jsx)(r.strong,{children:"tokens JWT"})," al momento de crear usuarios."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udccd Ubicaci\xf3n"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.code,{children:"src/services/user.service.ts"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-dependencias",children:"\ud83d\udce6 Dependencias"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"https://www.prisma.io/",children:(0,i.jsx)(r.code,{children:"prisma"})})," \u2014 Cliente de base de datos."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"https://cloudinary.com/",children:(0,i.jsx)(r.code,{children:"cloudinary"})})," \u2014 Manejo de im\xe1genes de perfil."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"https://www.npmjs.com/package/bcryptjs",children:(0,i.jsx)(r.code,{children:"bcryptjs"})})," \u2014 Encriptaci\xf3n de contrase\xf1as."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"https://www.npmjs.com/package/jsonwebtoken",children:(0,i.jsx)(r.code,{children:"jsonwebtoken"})})," \u2014 Generaci\xf3n y verificaci\xf3n de tokens JWT."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"../models/UserDTO",children:(0,i.jsx)(r.code,{children:"UserDTO"})})," \u2014 Definici\xf3n de datos de usuario."]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-variables-de-entorno",children:"\ud83d\udd11 Variables de Entorno"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"JWT_SECRET"})," \u2014 Clave secreta para firmar tokens JWT."]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-funciones",children:"\ud83d\udcdc Funciones"}),"\n",(0,i.jsxs)(r.h3,{id:"1-getallusersfilters-partialuserdto",children:["1. ",(0,i.jsx)(r.code,{children:"getAllUsers(filters: Partial<UserDTO>)"})]}),"\n",(0,i.jsx)(r.p,{children:"Obtiene una lista de usuarios filtrada por campos opcionales."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Par\xe1metros:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"filters"}),": Objeto parcial con propiedades de ",(0,i.jsx)(r.code,{children:"UserDTO"})," para filtrar (b\xfasqueda insensible a may\xfasculas en ",(0,i.jsx)(r.code,{children:"username"}),", ",(0,i.jsx)(r.code,{children:"correo"}),", ",(0,i.jsx)(r.code,{children:"nombreCompleto"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Retorna:"}),(0,i.jsx)(r.br,{}),"\n","Lista de usuarios coincidentes."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"2-getuserbyidid-number",children:["2. ",(0,i.jsx)(r.code,{children:"getUserById(id: number)"})]}),"\n",(0,i.jsxs)(r.p,{children:["Obtiene un usuario espec\xedfico por su ",(0,i.jsx)(r.code,{children:"idUsuario"}),"."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Par\xe1metros:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"id"}),": N\xfamero identificador del usuario."]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Retorna:"}),(0,i.jsx)(r.br,{}),"\n","El usuario encontrado o ",(0,i.jsx)(r.code,{children:"null"})," si no existe."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"3-createuserdata-userdto",children:["3. ",(0,i.jsx)(r.code,{children:"createUser(data: UserDTO)"})]}),"\n",(0,i.jsxs)(r.p,{children:["Crea un nuevo usuario con validaciones seg\xfan su rol y retorna tambi\xe9n un ",(0,i.jsx)(r.strong,{children:"token JWT"}),"."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Validaciones:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Si ",(0,i.jsx)(r.code,{children:'rol === "USUARIO"'})," \u2192 ",(0,i.jsx)(r.code,{children:"tipoUsuario"})," es obligatorio."]}),"\n",(0,i.jsxs)(r.li,{children:["Si ",(0,i.jsx)(r.code,{children:'rol === "EQUIPO"'})," \u2192 ",(0,i.jsx)(r.code,{children:"empresaId"})," es obligatorio y debe pertenecer a una empresa de tipo ",(0,i.jsx)(r.code,{children:'"EMPRESARIAL"'}),"."]}),"\n",(0,i.jsx)(r.li,{children:"Contrase\xf1a siempre encriptada antes de guardar."}),"\n",(0,i.jsxs)(r.li,{children:["Estado inicial ",(0,i.jsx)(r.code,{children:'"activo"'}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsxs)(r.strong,{children:["Payload del token generado (",(0,i.jsx)(r.code,{children:"24h"})," de expiraci\xf3n):"]})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "id": idUsuario,\r\n  "username": username,\r\n  "correo": correo,\r\n  "rol": rol,\r\n  "tipoUsuario": tipoUsuario,\r\n  "rolEquipo": rolEquipo,\r\n  "perfilCompleto": perfilCompleto,\r\n  "empresaId": empresaId\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Retorna:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"{\r\n  user: UsuarioCreado,\r\n  token: string\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Errores posibles:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"El tipoUsuario es obligatorio para rol USUARIO"'})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"empresaId es obligatorio para rol EQUIPO"'})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"La empresa especificada no existe o no es de tipo EMPRESARIAL"'})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"4-getempresabyidid-number",children:["4. ",(0,i.jsx)(r.code,{children:"getEmpresaById(id: number)"})]}),"\n",(0,i.jsxs)(r.p,{children:["Obtiene una empresa validando que sea de tipo ",(0,i.jsx)(r.code,{children:'"EMPRESARIAL"'}),"."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Par\xe1metros:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"id"}),": ID de la empresa."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Errores:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"Empresa no encontrada"'})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"El usuario no es de tipo EMPRESARIAL"'})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"5-updateuserid-number-data-partialuserdto",children:["5. ",(0,i.jsx)(r.code,{children:"updateUser(id: number, data: Partial<UserDTO>)"})]}),"\n",(0,i.jsx)(r.p,{children:"Actualiza un usuario existente."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Restricciones:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"No se permite cambiar el rol."}),"\n",(0,i.jsx)(r.li,{children:"Si se env\xeda una nueva contrase\xf1a, se encripta antes de guardar."}),"\n",(0,i.jsxs)(r.li,{children:["Si se env\xeda nueva ",(0,i.jsx)(r.code,{children:"fotoPerfil"})," y el usuario ya ten\xeda una, la anterior se elimina de ",(0,i.jsx)(r.strong,{children:"Cloudinary"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Errores:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"Usuario no encontrado"'})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"No est\xe1 permitido cambiar el rol del usuario."'})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"6-changeuserpasswordid-number-currentpassword-string-newpassword-string",children:["6. ",(0,i.jsx)(r.code,{children:"changeUserPassword(id: number, currentPassword: string, newPassword: string)"})]}),"\n",(0,i.jsx)(r.p,{children:"Cambia la contrase\xf1a de un usuario validando la actual."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Par\xe1metros:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"id"}),": ID del usuario."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"currentPassword"}),": Contrase\xf1a actual."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"newPassword"}),": Nueva contrase\xf1a."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Flujo:"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Verifica que el usuario exista."}),"\n",(0,i.jsxs)(r.li,{children:["Compara ",(0,i.jsx)(r.code,{children:"currentPassword"})," con la almacenada."]}),"\n",(0,i.jsx)(r.li,{children:"Si coincide, hashea y actualiza la contrase\xf1a."}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Retorna:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'{ message: "Contrase\xf1a actualizada correctamente" }\n'})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Errores:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"Usuario no encontrado"'})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"La contrase\xf1a actual es incorrecta"'})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"7-reactivarusuarioid-number",children:["7. ",(0,i.jsx)(r.code,{children:"reactivarUsuario(id: number)"})]}),"\n",(0,i.jsxs)(r.p,{children:["Restaura el estado de un usuario a ",(0,i.jsx)(r.code,{children:'"activo"'})," si estaba inactivo o eliminado."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Errores:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"Usuario no encontrado"'})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"El usuario ya est\xe1 activo"'})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"8-deleteuserid-number",children:["8. ",(0,i.jsx)(r.code,{children:"deleteUser(id: number)"})]}),"\n",(0,i.jsxs)(r.p,{children:["Elimina ",(0,i.jsx)(r.strong,{children:"l\xf3gicamente"})," un usuario (no se borra de la base de datos)."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Acciones:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Cambia ",(0,i.jsx)(r.code,{children:"estado"})," a ",(0,i.jsx)(r.code,{children:'"inactivo"'}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Asigna fecha a ",(0,i.jsx)(r.code,{children:"deletedAt"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Si el usuario es ",(0,i.jsx)(r.strong,{children:"EMPRESA"})," (",(0,i.jsx)(r.code,{children:'rol === "USUARIO"'})," y ",(0,i.jsx)(r.code,{children:'tipoUsuario === "EMPRESARIAL"'}),"), inactiva a todo su equipo (",(0,i.jsx)(r.code,{children:'rol: "EQUIPO"'}),") que est\xe9 activo."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Errores:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:'"Usuario no encontrado"'})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-observaciones",children:"\ud83e\udde0 Observaciones"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Todas las contrase\xf1as se almacenan encriptadas con ",(0,i.jsx)(r.code,{children:"bcryptjs"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["El borrado es ",(0,i.jsx)(r.strong,{children:"blando"})," (soft delete), permitiendo reactivaci\xf3n posterior."]}),"\n",(0,i.jsx)(r.li,{children:"El servicio centraliza la l\xf3gica de roles y relaciones empresa\u2013equipo."}),"\n",(0,i.jsxs)(r.li,{children:["El token JWT generado en ",(0,i.jsx)(r.code,{children:"createUser"})," est\xe1 pensado para autenticaci\xf3n en endpoints protegidos."]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>c,x:()=>a});var n=s(6540);const i={},d=n.createContext(i);function c(e){const r=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),n.createElement(d.Provider,{value:r},e.children)}}}]);