"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8802],{5017:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"backend/controllers/nutriscan.controller","title":"Controlador NutriScan","description":"Este controlador gestiona las operaciones CRUD para el m\xf3dulo NutriScan, que permite generar y administrar an\xe1lisis nutricionales basados en texto, usando inteligencia artificial y OCR. Las acciones est\xe1n protegidas por autenticaci\xf3n JWT y controladas seg\xfan el rol del usuario.","source":"@site/docs/backend/controllers/nutriscan.controller.md","sourceDirName":"backend/controllers","slug":"/backend/controllers/nutriscan.controller","permalink":"/producttrack/docs/backend/controllers/nutriscan.controller","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/controllers/nutriscan.controller.md","tags":[],"version":"current","frontMatter":{"id":"nutriscan.controller","title":"Controlador NutriScan","sidebar_label":"NutriScan"},"sidebar":"tutorialSidebar","previous":{"title":"Notificaciones","permalink":"/producttrack/docs/backend/controllers/notificaciones.controller"},"next":{"title":"OCR","permalink":"/producttrack/docs/backend/controllers/ocr.controller"}}');var i=n(4848),d=n(8453);const c={id:"nutriscan.controller",title:"Controlador NutriScan",sidebar_label:"NutriScan"},l="NutriScanController",a={},o=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udd12 Seguridad",id:"-seguridad",level:2},{value:"\ud83d\udce6 Dependencias clave",id:"-dependencias-clave",level:2},{value:"\ud83d\udcd8 Endpoints",id:"-endpoints",level:2},{value:"\ud83d\udcdd <code>POST /nutriscan</code>",id:"-post-nutriscan",level:3},{value:"Validaciones:",id:"validaciones",level:4},{value:"Respuestas:",id:"respuestas",level:4},{value:"\ud83d\udcc4 <code>GET /nutriscan</code>",id:"-get-nutriscan",level:3},{value:"Respuestas:",id:"respuestas-1",level:4},{value:"\ud83d\udc64 <code>GET /nutriscan/usuario/{usuarioId}</code>",id:"-get-nutriscanusuariousuarioid",level:3},{value:"Par\xe1metros:",id:"par\xe1metros",level:4},{value:"Respuestas:",id:"respuestas-2",level:4},{value:"\u270f\ufe0f <code>PUT /nutriscan/{id}</code>",id:"\ufe0f-put-nutriscanid",level:3},{value:"Par\xe1metros:",id:"par\xe1metros-1",level:4},{value:"Respuestas:",id:"respuestas-3",level:4},{value:"\ud83d\uddd1\ufe0f <code>DELETE /nutriscan/{id}</code>",id:"\ufe0f-delete-nutriscanid",level:3},{value:"Par\xe1metros:",id:"par\xe1metros-2",level:4},{value:"Respuestas:",id:"respuestas-4",level:4},{value:"\ud83e\uddea Ejemplo de uso (POST)",id:"-ejemplo-de-uso-post",level:2},{value:"\ud83d\udce6 Resumen de m\xe9todos",id:"-resumen-de-m\xe9todos",level:2}];function t(e){const s={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"nutriscancontroller",children:"NutriScanController"})}),"\n",(0,i.jsxs)(s.p,{children:["Este controlador gestiona las operaciones CRUD para el m\xf3dulo ",(0,i.jsx)(s.strong,{children:"NutriScan"}),", que permite generar y administrar an\xe1lisis nutricionales basados en texto, usando inteligencia artificial y OCR. Las acciones est\xe1n protegidas por autenticaci\xf3n JWT y controladas seg\xfan el rol del usuario."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"src/controller/nutriscan.controller.ts"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-seguridad",children:"\ud83d\udd12 Seguridad"}),"\n",(0,i.jsxs)(s.p,{children:["Todas las rutas est\xe1n protegidas mediante ",(0,i.jsx)(s.code,{children:'@Security("jwt")'}),". El acceso a cada operaci\xf3n est\xe1 determinado por el ",(0,i.jsx)(s.code,{children:"tipoUsuario"})," o ",(0,i.jsx)(s.code,{children:"rol"})," autenticado."]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Tipo de Usuario / Rol"}),(0,i.jsx)(s.th,{children:"Acciones Permitidas"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"INDIVIDUAL"})}),(0,i.jsx)(s.td,{children:"Crear an\xe1lisis"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ADMIN"})}),(0,i.jsx)(s.td,{children:"Ver, crear, actualizar y eliminar cualquier an\xe1lisis"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"DESARROLLADOR"})}),(0,i.jsx)(s.td,{children:"Crear an\xe1lisis de prueba y ver \xfanicamente los suyos"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-dependencias-clave",children:"\ud83d\udce6 Dependencias clave"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"NutriScanService"}),": Contiene la l\xf3gica de negocio para crear, consultar, actualizar y eliminar an\xe1lisis."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"NutriScanSchemaWithoutUserId"}),": Esquema de validaci\xf3n (",(0,i.jsx)(s.code,{children:"zod"}),") para crear nuevos registros."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"NutriScanUpdateSchema"}),": Esquema de validaci\xf3n para actualizar registros existentes."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-endpoints",children:"\ud83d\udcd8 Endpoints"}),"\n",(0,i.jsxs)(s.h3,{id:"-post-nutriscan",children:["\ud83d\udcdd ",(0,i.jsx)(s.code,{children:"POST /nutriscan"})]}),"\n",(0,i.jsxs)(s.p,{children:["Crea un nuevo an\xe1lisis nutricional.",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.strong,{children:"Disponible para:"})," ",(0,i.jsx)(s.code,{children:"INDIVIDUAL"}),", ",(0,i.jsx)(s.code,{children:"ADMIN"}),", ",(0,i.jsx)(s.code,{children:"DESARROLLADOR"})]}),"\n",(0,i.jsx)(s.h4,{id:"validaciones",children:"Validaciones:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Se valida el cuerpo usando ",(0,i.jsx)(s.code,{children:"NutriScanSchemaWithoutUserId"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Si el rol es ",(0,i.jsx)(s.code,{children:"DESARROLLADOR"}),", se marca como an\xe1lisis de prueba (",(0,i.jsx)(s.code,{children:"isTest = true"}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"respuestas",children:"Respuestas:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"201 Created"}),": Registro creado con \xe9xito."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"400 Bad Request"}),": Datos inv\xe1lidos."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"403 Forbidden"}),": El usuario no tiene permiso para usar NutriScan."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.h3,{id:"-get-nutriscan",children:["\ud83d\udcc4 ",(0,i.jsx)(s.code,{children:"GET /nutriscan"})]}),"\n",(0,i.jsx)(s.p,{children:"Devuelve todos los an\xe1lisis accesibles seg\xfan el rol del usuario autenticado."}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Rol"}),(0,i.jsx)(s.th,{children:"Acceso"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ADMIN"})}),(0,i.jsx)(s.td,{children:"Ver todos los registros (auditor\xeda)."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"DESARROLLADOR"})}),(0,i.jsx)(s.td,{children:"Ver solo los registros de prueba creados por s\xed mismo."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Otros"}),(0,i.jsx)(s.td,{children:"\u274c Acceso denegado."})]})]})]}),"\n",(0,i.jsx)(s.h4,{id:"respuestas-1",children:"Respuestas:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"200 OK"}),": Lista de registros."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.h3,{id:"-get-nutriscanusuariousuarioid",children:["\ud83d\udc64 ",(0,i.jsx)(s.code,{children:"GET /nutriscan/usuario/{usuarioId}"})]}),"\n",(0,i.jsxs)(s.p,{children:["Devuelve los an\xe1lisis asociados a un usuario espec\xedfico.",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.strong,{children:"Disponible solo para:"})," ",(0,i.jsx)(s.code,{children:"ADMIN"})]}),"\n",(0,i.jsx)(s.h4,{id:"par\xe1metros",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"usuarioId"}),": ID del usuario del cual se quieren consultar los an\xe1lisis."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"respuestas-2",children:"Respuestas:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"200 OK"}),": Lista de an\xe1lisis del usuario."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.h3,{id:"\ufe0f-put-nutriscanid",children:["\u270f\ufe0f ",(0,i.jsx)(s.code,{children:"PUT /nutriscan/{id}"})]}),"\n",(0,i.jsxs)(s.p,{children:["Actualiza parcialmente un an\xe1lisis existente.",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.strong,{children:"Disponible solo para:"})," ",(0,i.jsx)(s.code,{children:"ADMIN"})]}),"\n",(0,i.jsx)(s.h4,{id:"par\xe1metros-1",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"id"}),": ID del an\xe1lisis a modificar."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"body"}),": Cuerpo con los campos a actualizar (validado con ",(0,i.jsx)(s.code,{children:"NutriScanUpdateSchema"}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"respuestas-3",children:"Respuestas:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"200 OK"}),": Registro actualizado correctamente."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"400 Bad Request"}),": Validaci\xf3n fallida o cuerpo inv\xe1lido."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.h3,{id:"\ufe0f-delete-nutriscanid",children:["\ud83d\uddd1\ufe0f ",(0,i.jsx)(s.code,{children:"DELETE /nutriscan/{id}"})]}),"\n",(0,i.jsxs)(s.p,{children:["Elimina un an\xe1lisis por su ID.",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.strong,{children:"Disponible solo para:"})," ",(0,i.jsx)(s.code,{children:"ADMIN"})]}),"\n",(0,i.jsx)(s.h4,{id:"par\xe1metros-2",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"id"}),": ID del an\xe1lisis a eliminar."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"respuestas-4",children:"Respuestas:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"200 OK"}),": Eliminaci\xf3n exitosa."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-ejemplo-de-uso-post",children:"\ud83e\uddea Ejemplo de uso (POST)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:'// Crear an\xe1lisis nutricional (tipo INDIVIDUAL)\r\nfetch("/nutriscan", {\r\n  method: "POST",\r\n  headers: {\r\n    "Authorization": "Bearer <token>",\r\n    "Content-Type": "application/json"\r\n  },\r\n  body: JSON.stringify({\r\n    consulta: "Arroz integral",\r\n    esAlimento: true,\r\n    respuesta: {},\r\n    tipoAnalisis: "ocr-gpt-only"\r\n  })\r\n});\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-resumen-de-m\xe9todos",children:"\ud83d\udce6 Resumen de m\xe9todos"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"M\xe9todo"}),(0,i.jsx)(s.th,{children:"Ruta"}),(0,i.jsx)(s.th,{children:"Descripci\xf3n"}),(0,i.jsx)(s.th,{children:"Autorizado para"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"POST"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/nutriscan"})}),(0,i.jsx)(s.td,{children:"Crear nuevo an\xe1lisis"}),(0,i.jsx)(s.td,{children:"INDIVIDUAL, ADMIN, DEV"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"GET"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/nutriscan"})}),(0,i.jsx)(s.td,{children:"Obtener an\xe1lisis seg\xfan el rol"}),(0,i.jsx)(s.td,{children:"ADMIN, DESARROLLADOR"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"GET"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/nutriscan/usuario/{id}"})}),(0,i.jsx)(s.td,{children:"Consultar an\xe1lisis de un usuario"}),(0,i.jsx)(s.td,{children:"ADMIN"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"PUT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/nutriscan/{id}"})}),(0,i.jsx)(s.td,{children:"Actualizar un an\xe1lisis"}),(0,i.jsx)(s.td,{children:"ADMIN"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"DELETE"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/nutriscan/{id}"})}),(0,i.jsx)(s.td,{children:"Eliminar un an\xe1lisis"}),(0,i.jsx)(s.td,{children:"ADMIN"})]})]})]})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>l});var r=n(6540);const i={},d=r.createContext(i);function c(e){const s=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(d.Provider,{value:s},e.children)}}}]);