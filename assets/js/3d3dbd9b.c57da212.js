"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1452],{1825:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>n,metadata:()=>d,toc:()=>t});const d=JSON.parse('{"id":"backend/middleware/roles.middleware","title":"Middleware de roles","description":"Este middleware permite restringir el acceso a rutas bas\xe1ndose en el rol principal del usuario (user.rol) y, opcionalmente, en su rol dentro de un equipo (user.rolEquipo). Tambi\xe9n permite verificar si el usuario pertenece al tipo EMPRESARIAL.","source":"@site/docs/backend/middleware/roles.middleware.md","sourceDirName":"backend/middleware","slug":"/backend/middleware/roles.middleware","permalink":"/producttrack/docs/backend/middleware/roles.middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/middleware/roles.middleware.md","tags":[],"version":"current","frontMatter":{"id":"roles.middleware","title":"Middleware de roles","sidebar_label":"Roles"},"sidebar":"tutorialSidebar","previous":{"title":"historial","permalink":"/producttrack/docs/backend/middleware/historial"},"next":{"title":"Token","permalink":"/producttrack/docs/backend/middleware/token.middleware"}}');var s=i(4848),l=i(8453);const n={id:"roles.middleware",title:"Middleware de roles",sidebar_label:"Roles"},o=void 0,c={},t=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udccc Prop\xf3sito",id:"-prop\xf3sito",level:2},{value:"\ud83d\udce5 Importaciones",id:"-importaciones",level:2},{value:"\ud83e\udde0 Firma del middleware",id:"-firma-del-middleware",level:2},{value:"Par\xe1metros",id:"par\xe1metros",level:3},{value:"\u2705 Ejemplo de uso",id:"-ejemplo-de-uso",level:2},{value:"\u26a0\ufe0f Respuestas de error posibles",id:"\ufe0f-respuestas-de-error-posibles",level:2},{value:"\ud83e\uddea Flujo de ejecuci\xf3n",id:"-flujo-de-ejecuci\xf3n",level:2},{value:"\ud83e\udde9 Dependencias",id:"-dependencias",level:2}];function a(e){const r={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:["Este middleware permite restringir el acceso a rutas bas\xe1ndose en el ",(0,s.jsx)(r.strong,{children:"rol principal del usuario"})," (",(0,s.jsx)(r.code,{children:"user.rol"}),") y, opcionalmente, en su ",(0,s.jsx)(r.strong,{children:"rol dentro de un equipo"})," (",(0,s.jsx)(r.code,{children:"user.rolEquipo"}),"). Tambi\xe9n permite verificar si el usuario pertenece al tipo ",(0,s.jsx)(r.code,{children:"EMPRESARIAL"}),"."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.code,{children:"src/middleware/roles.middleware.ts"})}),"\n",(0,s.jsx)(r.h2,{id:"-prop\xf3sito",children:"\ud83d\udccc Prop\xf3sito"}),"\n",(0,s.jsx)(r.p,{children:"Limitar el acceso a ciertas rutas a:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Usuarios con roles espec\xedficos (ej. ",(0,s.jsx)(r.code,{children:"ADMIN"}),", ",(0,s.jsx)(r.code,{children:"EMPRESARIAL"}),", ",(0,s.jsx)(r.code,{children:"EQUIPO"}),", etc.)"]}),"\n",(0,s.jsx)(r.li,{children:"Usuarios de tipo empresarial, si se requiere"}),"\n",(0,s.jsx)(r.li,{children:"Usuarios de equipo con roles espec\xedficos dentro del equipo (opcional)"}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"-importaciones",children:"\ud83d\udce5 Importaciones"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Response, NextFunction } from "express";\r\nimport { AuthenticatedRequest } from "./token.middleware";\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"AuthenticatedRequestTocken"})," es una extensi\xf3n de ",(0,s.jsx)(r.code,{children:"Request"})," que incluye la propiedad ",(0,s.jsx)(r.code,{children:"user"}),", a\xf1adida previamente por el middleware de autenticaci\xf3n (",(0,s.jsx)(r.code,{children:"token.middleware"}),")."]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"-firma-del-middleware",children:"\ud83e\udde0 Firma del middleware"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"permitirRolesYRolEquipo(\r\n  rolesPermitidos: string[],\r\n  rolesEquipoPermitidos?: string[],\r\n  requiereTipoEmpresarial = false\r\n)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Par\xe1metro"}),(0,s.jsx)(r.th,{children:"Tipo"}),(0,s.jsx)(r.th,{children:"Descripci\xf3n"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"rolesPermitidos"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"string[]"})}),(0,s.jsx)(r.td,{children:"Lista de roles principales autorizados para acceder a la ruta."})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"rolesEquipoPermitidos"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"string[]?"})}),(0,s.jsxs)(r.td,{children:["(Opcional) Lista de roles v\xe1lidos para usuarios del tipo ",(0,s.jsx)(r.code,{children:"EQUIPO"}),"."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"requiereTipoEmpresarial"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"boolean"})}),(0,s.jsxs)(r.td,{children:["(Opcional) Si se requiere que el usuario sea del tipo ",(0,s.jsx)(r.code,{children:"EMPRESARIAL"}),". Por defecto es ",(0,s.jsx)(r.code,{children:"false"}),"."]})]})]})]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"-ejemplo-de-uso",children:"\u2705 Ejemplo de uso"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { permitirRolesYRolEquipo } from "../middleware/roles.middleware";\r\n\r\n// Solo ADMIN y EMPRESARIAL pueden acceder\r\nrouter.post(\r\n  "/crear-usuario",\r\n  permitirRolesYRolEquipo(["ADMIN", "EMPRESARIAL"], ["editor", "admin"], true),\r\n  controlador.crearUsuario\r\n);\n'})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\ufe0f-respuestas-de-error-posibles",children:"\u26a0\ufe0f Respuestas de error posibles"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"C\xf3digo"}),(0,s.jsx)(r.th,{children:"Mensaje"}),(0,s.jsx)(r.th,{children:"Situaci\xf3n"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"403"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:'"Acceso no autorizado"'})}),(0,s.jsx)(r.td,{children:"No hay informaci\xf3n del usuario en la petici\xf3n."})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"403"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:'"Rol no permitido"'})}),(0,s.jsxs)(r.td,{children:["El ",(0,s.jsx)(r.code,{children:"user.rol"})," no est\xe1 en la lista de roles permitidos."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"403"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:'"Acceso denegado. Solo las empresas..."'})}),(0,s.jsxs)(r.td,{children:["El usuario no es del tipo ",(0,s.jsx)(r.code,{children:"EMPRESARIAL"})," y se requiere."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"403"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:'"Rol de equipo no permitido"'})}),(0,s.jsxs)(r.td,{children:["El ",(0,s.jsx)(r.code,{children:"user.rol"})," es ",(0,s.jsx)(r.code,{children:"EQUIPO"}),", pero no tiene el rol dentro del equipo adecuado."]})]})]})]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"-flujo-de-ejecuci\xf3n",children:"\ud83e\uddea Flujo de ejecuci\xf3n"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["Se verifica que ",(0,s.jsx)(r.code,{children:"req.user"})," exista."]}),"\n",(0,s.jsxs)(r.li,{children:["Se valida si el rol principal (",(0,s.jsx)(r.code,{children:"user.rol"}),") est\xe1 permitido."]}),"\n",(0,s.jsxs)(r.li,{children:["Si se requiere, se valida que el ",(0,s.jsx)(r.code,{children:"tipoUsuario"})," sea ",(0,s.jsx)(r.code,{children:"EMPRESARIAL"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Si el rol es ",(0,s.jsx)(r.code,{children:"EQUIPO"}),", se valida que tenga un ",(0,s.jsx)(r.code,{children:"rolEquipo"})," autorizado."]}),"\n",(0,s.jsxs)(r.li,{children:["Si todo es v\xe1lido, se ejecuta ",(0,s.jsx)(r.code,{children:"next()"})," para continuar con la siguiente funci\xf3n en la ruta."]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"-dependencias",children:"\ud83e\udde9 Dependencias"}),"\n",(0,s.jsxs)(r.p,{children:["Este middleware depende del middleware de autenticaci\xf3n que a\xf1ade ",(0,s.jsx)(r.code,{children:"req.user"}),", generalmente implementado en:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"token.middleware.ts\n"})})]})}function h(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,r,i)=>{i.d(r,{R:()=>n,x:()=>o});var d=i(6540);const s={},l=d.createContext(s);function n(e){const r=d.useContext(l);return d.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:n(e.components),d.createElement(l.Provider,{value:r},e.children)}}}]);