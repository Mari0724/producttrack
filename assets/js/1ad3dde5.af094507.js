"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[516],{7395:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"backend/services/historial.service","title":"Servicio de Historial de Inventario","description":"Este servicio permite consultar el historial de cambios en el inventario asociados a un usuario o empresa, dependiendo de su tipo de cuenta (INDIVIDUAL o EMPRESARIAL).","source":"@site/docs/backend/services/historial.service.md","sourceDirName":"backend/services","slug":"/backend/services/historial.service","permalink":"/producttrack/docs/backend/services/historial.service","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/services/historial.service.md","tags":[],"version":"current","frontMatter":{"id":"historial.service","title":"Servicio de Historial de Inventario","sidebar_label":"Historial de Inventario"},"sidebar":"tutorialSidebar","previous":{"title":"GPT","permalink":"/producttrack/docs/backend/services/gpt.service"},"next":{"title":"Log","permalink":"/producttrack/docs/backend/services/log.service"}}');var r=n(4848),o=n(8453);const c={id:"historial.service",title:"Servicio de Historial de Inventario",sidebar_label:"Historial de Inventario"},d=void 0,l={},a=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udce6 Dependencias",id:"-dependencias",level:2},{value:"\ud83e\udde9 Funci\xf3n: <code>async obtenerHistorialInventario(idUsuario: number)</code>",id:"-funci\xf3n-async-obtenerhistorialinventarioidusuario-number",level:2},{value:"Par\xe1metros:",id:"par\xe1metros",level:3},{value:"Retorna:",id:"retorna",level:3},{value:"Flujo de ejecuci\xf3n:",id:"flujo-de-ejecuci\xf3n",level:3},{value:"Casos especiales:",id:"casos-especiales",level:3},{value:"\u2705 Validaci\xf3n y reglas",id:"-validaci\xf3n-y-reglas",level:2},{value:"\ud83e\uddea Ejemplo de uso",id:"-ejemplo-de-uso",level:2}];function t(e){const i={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.p,{children:["Este servicio permite ",(0,r.jsx)(i.strong,{children:"consultar el historial de cambios en el inventario"})," asociados a un usuario o empresa, dependiendo de su tipo de cuenta (",(0,r.jsx)(i.code,{children:"INDIVIDUAL"})," o ",(0,r.jsx)(i.code,{children:"EMPRESARIAL"}),")."]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"src/services/historial.service.ts"})}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"-dependencias",children:"\ud83d\udce6 Dependencias"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:(0,r.jsx)(i.code,{children:"prisma"})}),": Cliente ORM para interactuar con la base de datos."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:(0,r.jsx)(i.code,{children:"HistorialInventarioDTO"})}),": Tipo de datos que define la estructura del historial devuelto."]}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsxs)(i.h2,{id:"-funci\xf3n-async-obtenerhistorialinventarioidusuario-number",children:["\ud83e\udde9 Funci\xf3n: ",(0,r.jsx)(i.code,{children:"async obtenerHistorialInventario(idUsuario: number)"})]}),"\n",(0,r.jsxs)(i.p,{children:["Obtiene el historial de cambios en el inventario asociado a un usuario espec\xedfico, ya sea ",(0,r.jsx)(i.strong,{children:"individual"})," o ",(0,r.jsx)(i.strong,{children:"empresarial"}),"."]}),"\n",(0,r.jsx)(i.h3,{id:"par\xe1metros",children:"Par\xe1metros:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:(0,r.jsx)(i.code,{children:"idUsuario"})}),": ",(0,r.jsx)(i.code,{children:"number"})," \u2014 Identificador \xfanico del usuario que solicita el historial."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"retorna",children:"Retorna:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:(0,r.jsx)(i.code,{children:"Promise<HistorialInventarioDTO[]>"})})," \u2014 Lista de registros de historial que incluyen:","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"id"}),": Identificador del historial."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"productoId"}),": ID del producto."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"nombreProducto"}),": Nombre del producto."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"accion"}),": Tipo de cambio realizado."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"cantidad_anterior"})," y ",(0,r.jsx)(i.code,{children:"cantidad_nueva"}),": Cambios de cantidad."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"precio_anterior"})," y ",(0,r.jsx)(i.code,{children:"precio_nuevo"}),": Cambios de precio."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"fechaCambio"}),": Fecha y hora del cambio."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"flujo-de-ejecuci\xf3n",children:"Flujo de ejecuci\xf3n:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Obtenci\xf3n del usuario"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Consulta en la tabla ",(0,r.jsx)(i.code,{children:"users"})," el tipo de usuario y el ",(0,r.jsx)(i.code,{children:"empresaId"})," asociado."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Identificaci\xf3n de productos"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Si es ",(0,r.jsx)(i.strong,{children:(0,r.jsx)(i.code,{children:"INDIVIDUAL"})}),": se listan los productos cuyo ",(0,r.jsx)(i.code,{children:"usuarioId"})," coincida con el ",(0,r.jsx)(i.code,{children:"idUsuario"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:["Si es ",(0,r.jsx)(i.strong,{children:(0,r.jsx)(i.code,{children:"EMPRESARIAL"})}),":","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Se usa ",(0,r.jsx)(i.code,{children:"empresaId"})," del usuario, o el propio ",(0,r.jsx)(i.code,{children:"idUsuario"})," si est\xe1 nulo."]}),"\n",(0,r.jsx)(i.li,{children:"Se listan todos los productos cuyo usuario pertenezca a la empresa."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Consulta de historial"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Busca en ",(0,r.jsx)(i.code,{children:"histInv"})," todos los registros relacionados con los ",(0,r.jsx)(i.code,{children:"productosIds"})," encontrados."]}),"\n",(0,r.jsxs)(i.li,{children:["Incluye el nombre del producto (",(0,r.jsx)(i.code,{children:"producto.nombre"}),")."]}),"\n",(0,r.jsxs)(i.li,{children:["Ordena los resultados por ",(0,r.jsx)(i.code,{children:"fechaCambio"})," de forma descendente."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Transformaci\xf3n de datos"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Mapea cada registro para ajustarse al tipo ",(0,r.jsx)(i.code,{children:"HistorialInventarioDTO"}),", convirtiendo los precios a tipo ",(0,r.jsx)(i.code,{children:"number"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"casos-especiales",children:"Casos especiales:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Si el usuario no existe en la base de datos, retorna un arreglo vac\xedo."}),"\n",(0,r.jsx)(i.li,{children:"Si no hay productos asociados, retorna un arreglo vac\xedo."}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"-validaci\xf3n-y-reglas",children:"\u2705 Validaci\xf3n y reglas"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Se valida que el usuario exista antes de procesar el historial."}),"\n",(0,r.jsxs)(i.li,{children:["Para ",(0,r.jsx)(i.strong,{children:"cuentas empresariales"})," se controla el caso en que ",(0,r.jsx)(i.code,{children:"empresaId"})," sea ",(0,r.jsx)(i.code,{children:"null"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:["El historial siempre se devuelve ",(0,r.jsx)(i.strong,{children:"ordenado del m\xe1s reciente al m\xe1s antiguo"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"-ejemplo-de-uso",children:"\ud83e\uddea Ejemplo de uso"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-ts",children:'import { obtenerHistorialInventario } from "./services/historial.service";\r\n\r\nconst historial = await obtenerHistorialInventario(5);\r\n\r\nconsole.log(historial);\r\n/*\r\n[\r\n  {\r\n    id: 12,\r\n    productoId: 3,\r\n    nombreProducto: "Laptop Dell",\r\n    accion: "ACTUALIZACI\xd3N",\r\n    cantidad_anterior: 10,\r\n    cantidad_nueva: 8,\r\n    precio_anterior: 1200,\r\n    precio_nuevo: 1150,\r\n    fechaCambio: 2025-08-06T14:32:00.000Z\r\n  },\r\n  ...\r\n]\r\n*/\n'})}),"\n",(0,r.jsx)(i.hr,{})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>c,x:()=>d});var s=n(6540);const r={},o=s.createContext(r);function c(e){const i=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(o.Provider,{value:i},e.children)}}}]);