"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7295],{2550:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"backend/controllers/ocr.controller","title":"Controlador OCR","description":"Este controlador maneja la l\xf3gica relacionada con el an\xe1lisis de im\xe1genes usando OCR (Reconocimiento \xd3ptico de Caracteres), GPT e integraci\xf3n con OpenFoodFacts. Proporciona endpoints para extraer texto desde im\xe1genes y confirmar manualmente productos no reconocidos.","source":"@site/docs/backend/controllers/ocr.controller.md","sourceDirName":"backend/controllers","slug":"/backend/controllers/ocr.controller","permalink":"/producttrack/docs/backend/controllers/ocr.controller","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/controllers/ocr.controller.md","tags":[],"version":"current","frontMatter":{"id":"ocr.controller","title":"Controlador OCR","sidebar_label":"OCR"},"sidebar":"tutorialSidebar","previous":{"title":"NutriScan","permalink":"/producttrack/docs/backend/controllers/nutriscan.controller"},"next":{"title":"Preferencias","permalink":"/producttrack/docs/backend/controllers/preferencias.controller"}}');var i=r(4848),s=r(8453);const l={id:"ocr.controller",title:"Controlador OCR",sidebar_label:"OCR"},a="OCRController",c={},d=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udce6 Dependencias",id:"-dependencias",level:2},{value:"\ud83d\ude80 Endpoints",id:"-endpoints",level:2},{value:"\ud83d\udce4 <code>POST /ocr/extraerTextoDesdeImagen</code>",id:"-post-ocrextraertextodesdeimagen",level:3},{value:"Par\xe1metros",id:"par\xe1metros",level:4},{value:"Flujo de trabajo",id:"flujo-de-trabajo",level:4},{value:"Validaciones",id:"validaciones",level:4},{value:"Respuestas",id:"respuestas",level:4},{value:"Ejemplo de respuesta",id:"ejemplo-de-respuesta",level:4},{value:"\ud83d\udcdd <code>POST /ocr/confirmarNombreManual</code>",id:"-post-ocrconfirmarnombremanual",level:3},{value:"Par\xe1metros",id:"par\xe1metros-1",level:4},{value:"Flujo de trabajo",id:"flujo-de-trabajo-1",level:4},{value:"Validaciones",id:"validaciones-1",level:4},{value:"Respuestas",id:"respuestas-1",level:4},{value:"Ejemplo de respuesta",id:"ejemplo-de-respuesta-1",level:4},{value:"\u2705 Consideraciones t\xe9cnicas",id:"-consideraciones-t\xe9cnicas",level:2}];function t(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ocrcontroller",children:"OCRController"})}),"\n",(0,i.jsx)(n.p,{children:"Este controlador maneja la l\xf3gica relacionada con el an\xe1lisis de im\xe1genes usando OCR (Reconocimiento \xd3ptico de Caracteres), GPT e integraci\xf3n con OpenFoodFacts. Proporciona endpoints para extraer texto desde im\xe1genes y confirmar manualmente productos no reconocidos."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"src/controller/ocr.controller.ts"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-dependencias",children:"\ud83d\udce6 Dependencias"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cloudinaryUploadBuffer"}),", ",(0,i.jsx)(n.code,{children:"obtenerUrlPreprocesada"}),": Subida de im\xe1genes a Cloudinary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"createOcrClient"}),": Cliente OCR que procesa la imagen desde Cloudinary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"limpiarTextoOCR"}),", ",(0,i.jsx)(n.code,{children:"corregirErroresOCR"}),", ",(0,i.jsx)(n.code,{children:"obtenerCandidatosProductos"}),", ",(0,i.jsx)(n.code,{children:"elegirMejorResultado"}),": Utilidades para procesar y analizar texto extra\xeddo."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OpenFoodFactsService"}),": Consulta de informaci\xf3n alimentaria externa."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gptService"}),": Generaci\xf3n de mensajes nutricionales con IA."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prisma"}),": ORM para registrar datos en la base de datos (",(0,i.jsx)(n.code,{children:"nutriScan"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"preprocesarImagen"}),": Procesamiento previo de im\xe1genes antes de aplicar OCR."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-endpoints",children:"\ud83d\ude80 Endpoints"}),"\n",(0,i.jsxs)(n.h3,{id:"-post-ocrextraertextodesdeimagen",children:["\ud83d\udce4 ",(0,i.jsx)(n.code,{children:"POST /ocr/extraerTextoDesdeImagen"})]}),"\n",(0,i.jsx)(n.p,{children:"Procesa una imagen enviada, realiza OCR, analiza el texto y genera un mensaje nutricional usando inteligencia artificial."}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"req.file"}),": Imagen (tipo ",(0,i.jsx)(n.code,{children:"multipart/form-data"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"req.body.usuarioId"}),": ID del usuario que realiza la solicitud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"req.body.tipoAnalisis"}),": Tipo de an\xe1lisis. Solo se permite ",(0,i.jsx)(n.code,{children:"ocr-gpt-only"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"flujo-de-trabajo",children:"Flujo de trabajo"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Preprocesa la imagen y la sube a Cloudinary."}),"\n",(0,i.jsx)(n.li,{children:"Extrae texto desde la imagen usando OCR."}),"\n",(0,i.jsx)(n.li,{children:"Limpia y corrige el texto extra\xeddo."}),"\n",(0,i.jsx)(n.li,{children:"Detecta posibles nombres de productos."}),"\n",(0,i.jsx)(n.li,{children:"Consulta OpenFoodFacts usando el nombre detectado."}),"\n",(0,i.jsx)(n.li,{children:"Genera un mensaje nutricional con GPT."}),"\n",(0,i.jsxs)(n.li,{children:["Registra el an\xe1lisis en la base de datos (",(0,i.jsx)(n.code,{children:"nutriScan"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"validaciones",children:"Validaciones"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Imagen obligatoria."}),"\n",(0,i.jsx)(n.li,{children:"Texto extra\xeddo no puede estar vac\xedo."}),"\n",(0,i.jsxs)(n.li,{children:["Solo se permite el tipo de an\xe1lisis ",(0,i.jsx)(n.code,{children:"ocr-gpt-only"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas",children:"Respuestas"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"201 Created"}),": Registro guardado correctamente."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"}),": Faltan datos o errores de validaci\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Error inesperado en el procesamiento."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"ejemplo-de-respuesta",children:"Ejemplo de respuesta"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "mensaje": "An\xe1lisis completado",\r\n  "registro": { ... },\r\n  "resultadoOpenFoodFacts": { ... },\r\n  "mensajeGPT": "Este producto contiene...",\r\n  "requiereConfirmacion": false,\r\n  "sugerencia": "Cereal con avena"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"-post-ocrconfirmarnombremanual",children:["\ud83d\udcdd ",(0,i.jsx)(n.code,{children:"POST /ocr/confirmarNombreManual"})]}),"\n",(0,i.jsx)(n.p,{children:"Confirma manualmente el nombre de un producto cuando no se detect\xf3 correctamente desde la imagen."}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros-1",children:"Par\xe1metros"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"registroId"}),": ID del an\xe1lisis previamente creado."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"nombreProducto"}),": Nombre proporcionado manualmente."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tipoAnalisis"})," ",(0,i.jsx)(n.em,{children:"(opcional)"}),": Tipo de an\xe1lisis (por defecto, ",(0,i.jsx)(n.code,{children:'"manual"'}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"flujo-de-trabajo-1",children:"Flujo de trabajo"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verifica que el nombre y ",(0,i.jsx)(n.code,{children:"registroId"})," sean v\xe1lidos."]}),"\n",(0,i.jsx)(n.li,{children:"Consulta OpenFoodFacts con el nombre proporcionado."}),"\n",(0,i.jsx)(n.li,{children:"Genera mensaje nutricional con GPT."}),"\n",(0,i.jsx)(n.li,{children:"Actualiza el registro existente con la nueva informaci\xf3n."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"validaciones-1",children:"Validaciones"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"registroId"})," y ",(0,i.jsx)(n.code,{children:"nombreProducto"})," son obligatorios."]}),"\n",(0,i.jsx)(n.li,{children:"El nombre debe tener contenido v\xe1lido."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas-1",children:"Respuestas"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": An\xe1lisis manual actualizado correctamente."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"}),": Faltan datos requeridos o errores de validaci\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Error inesperado."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"ejemplo-de-respuesta-1",children:"Ejemplo de respuesta"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "mensaje": "An\xe1lisis manual completado",\r\n  "registro": { ... },\r\n  "resultadoOpenFoodFacts": { ... },\r\n  "mensajeGPT": "Contiene az\xfacares a\xf1adidos..."\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-consideraciones-t\xe9cnicas",children:"\u2705 Consideraciones t\xe9cnicas"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El sistema intenta detectar autom\xe1ticamente un producto; si falla, sugiere uno y solicita confirmaci\xf3n manual."}),"\n",(0,i.jsx)(n.li,{children:"En caso de no haber coincidencias en OpenFoodFacts, se genera igualmente un mensaje con GPT usando el texto corregido."}),"\n",(0,i.jsxs)(n.li,{children:["Se registra si el an\xe1lisis fue ",(0,i.jsx)(n.code,{children:"ocr-gpt-only"})," o ",(0,i.jsx)(n.code,{children:"manual"}),", permitiendo seguimiento posterior."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>a});var o=r(6540);const i={},s=o.createContext(i);function l(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);