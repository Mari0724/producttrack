"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8802],{5017:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"backend/controllers/nutriscan.controller","title":"Controlador NutriScan","description":"Este controlador maneja las operaciones CRUD del m\xf3dulo NutriScan, una herramienta para generar an\xe1lisis nutricionales a partir de texto OCR o entradas manuales. La l\xf3gica de negocio es delegada al NutriScanService y se controla el acceso por tipo de usuario o rol (INDIVIDUAL, ADMIN, DESARROLLADOR).","source":"@site/docs/backend/controllers/nutriscan.controller.md","sourceDirName":"backend/controllers","slug":"/backend/controllers/nutriscan.controller","permalink":"/producttrack/docs/backend/controllers/nutriscan.controller","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/controllers/nutriscan.controller.md","tags":[],"version":"current","frontMatter":{"id":"nutriscan.controller","title":"Controlador NutriScan","sidebar_label":"NutriScan"},"sidebar":"tutorialSidebar","previous":{"title":"Login","permalink":"/producttrack/docs/backend/controllers/log.controller"},"next":{"title":"OCR","permalink":"/producttrack/docs/backend/controllers/ocr.controller"}}');var i=s(4848),d=s(8453);const c={id:"nutriscan.controller",title:"Controlador NutriScan",sidebar_label:"NutriScan"},l="NutriScanController",a={},o=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udd12 Seguridad",id:"-seguridad",level:2},{value:"\ud83e\uddf1 Dependencias clave",id:"-dependencias-clave",level:2},{value:"\ud83d\udcd8 Endpoints",id:"-endpoints",level:2},{value:"\ud83d\udcdd <code>POST /nutriscan</code>",id:"-post-nutriscan",level:3},{value:"Validaciones:",id:"validaciones",level:4},{value:"Respuestas:",id:"respuestas",level:4},{value:"\ud83d\udcc4 <code>GET /nutriscan</code>",id:"-get-nutriscan",level:3},{value:"Respuestas:",id:"respuestas-1",level:4},{value:"\ud83d\udc64 <code>GET /nutriscan/usuario/{usuarioId}</code>",id:"-get-nutriscanusuariousuarioid",level:3},{value:"Par\xe1metros:",id:"par\xe1metros",level:4},{value:"Respuestas:",id:"respuestas-2",level:4},{value:"\u270f\ufe0f <code>PUT /nutriscan/{id}</code>",id:"\ufe0f-put-nutriscanid",level:3},{value:"Par\xe1metros:",id:"par\xe1metros-1",level:4},{value:"Respuestas:",id:"respuestas-3",level:4},{value:"\ud83d\uddd1\ufe0f <code>DELETE /nutriscan/{id}</code>",id:"\ufe0f-delete-nutriscanid",level:3},{value:"Par\xe1metros:",id:"par\xe1metros-2",level:4},{value:"Respuestas:",id:"respuestas-4",level:4},{value:"\ud83e\uddea Ejemplo de uso (POST)",id:"-ejemplo-de-uso-post",level:2},{value:"\ud83d\udce6 Resumen de m\xe9todos",id:"-resumen-de-m\xe9todos",level:2}];function t(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"nutriscancontroller",children:"NutriScanController"})}),"\n",(0,i.jsxs)(n.p,{children:["Este controlador maneja las operaciones CRUD del m\xf3dulo ",(0,i.jsx)(n.strong,{children:"NutriScan"}),", una herramienta para generar an\xe1lisis nutricionales a partir de texto OCR o entradas manuales. La l\xf3gica de negocio es delegada al ",(0,i.jsx)(n.code,{children:"NutriScanService"})," y se controla el acceso por tipo de usuario o rol (",(0,i.jsx)(n.code,{children:"INDIVIDUAL"}),", ",(0,i.jsx)(n.code,{children:"ADMIN"}),", ",(0,i.jsx)(n.code,{children:"DESARROLLADOR"}),")."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"src/controller/nutriscan.controller.ts"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-seguridad",children:"\ud83d\udd12 Seguridad"}),"\n",(0,i.jsxs)(n.p,{children:["Todas las rutas est\xe1n protegidas con ",(0,i.jsx)(n.code,{children:'@Security("jwt")'})," y validan el ",(0,i.jsx)(n.code,{children:"rol"})," o ",(0,i.jsx)(n.code,{children:"tipoUsuario"})," del usuario autenticado."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Tipo de Usuario / Rol"}),(0,i.jsx)(n.th,{children:"Acciones Permitidas"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INDIVIDUAL"})}),(0,i.jsx)(n.td,{children:"Crear an\xe1lisis"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ADMIN"})}),(0,i.jsx)(n.td,{children:"Ver, crear, actualizar y eliminar"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DESARROLLADOR"})}),(0,i.jsx)(n.td,{children:"Crear an\xe1lisis de prueba y ver los suyos"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-dependencias-clave",children:"\ud83e\uddf1 Dependencias clave"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"NutriScanService"}),": L\xf3gica principal de NutriScan."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"NutriScanSchemaWithoutUserId"}),": Validaci\xf3n de datos de entrada (",(0,i.jsx)(n.code,{children:"zod"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"NutriScanUpdateSchema"}),": Validaci\xf3n para actualizaciones."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-endpoints",children:"\ud83d\udcd8 Endpoints"}),"\n",(0,i.jsxs)(n.h3,{id:"-post-nutriscan",children:["\ud83d\udcdd ",(0,i.jsx)(n.code,{children:"POST /nutriscan"})]}),"\n",(0,i.jsxs)(n.p,{children:["Crea un nuevo an\xe1lisis nutricional.",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Disponible para:"})," ",(0,i.jsx)(n.code,{children:"INDIVIDUAL"}),", ",(0,i.jsx)(n.code,{children:"ADMIN"}),", ",(0,i.jsx)(n.code,{children:"DESARROLLADOR"})]}),"\n",(0,i.jsx)(n.h4,{id:"validaciones",children:"Validaciones:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Se usa ",(0,i.jsx)(n.code,{children:"NutriScanSchemaWithoutUserId"})," para validar el cuerpo."]}),"\n",(0,i.jsxs)(n.li,{children:["Si el usuario es desarrollador, el an\xe1lisis se marca como prueba (",(0,i.jsx)(n.code,{children:"isTest = true"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas",children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"201 Created"}),": Registro creado con \xe9xito."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"}),": Datos inv\xe1lidos."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"-get-nutriscan",children:["\ud83d\udcc4 ",(0,i.jsx)(n.code,{children:"GET /nutriscan"})]}),"\n",(0,i.jsx)(n.p,{children:"Devuelve los an\xe1lisis disponibles seg\xfan el rol del usuario."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Rol"}),(0,i.jsx)(n.th,{children:"Acceso"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ADMIN"})}),(0,i.jsx)(n.td,{children:"Todos los registros (auditor\xeda)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DESARROLLADOR"})}),(0,i.jsx)(n.td,{children:"Solo los registros de prueba que ha creado"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Otro"}),(0,i.jsx)(n.td,{children:"\u274c Acceso denegado"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas-1",children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Lista de an\xe1lisis."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"-get-nutriscanusuariousuarioid",children:["\ud83d\udc64 ",(0,i.jsx)(n.code,{children:"GET /nutriscan/usuario/{usuarioId}"})]}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve los an\xe1lisis de un usuario espec\xedfico.",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Disponible para:"})," ",(0,i.jsx)(n.code,{children:"ADMIN"})]}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"usuarioId"}),": ID num\xe9rico del usuario."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas-2",children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Registros encontrados."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"\ufe0f-put-nutriscanid",children:["\u270f\ufe0f ",(0,i.jsx)(n.code,{children:"PUT /nutriscan/{id}"})]}),"\n",(0,i.jsxs)(n.p,{children:["Actualiza parcialmente un an\xe1lisis.",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Disponible para:"})," ",(0,i.jsx)(n.code,{children:"ADMIN"})]}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros-1",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id"}),": ID del an\xe1lisis."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"body"}),": Datos a modificar, validados con ",(0,i.jsx)(n.code,{children:"NutriScanUpdateSchema"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas-3",children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Registro actualizado."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"}),": Error de validaci\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"\ufe0f-delete-nutriscanid",children:["\ud83d\uddd1\ufe0f ",(0,i.jsx)(n.code,{children:"DELETE /nutriscan/{id}"})]}),"\n",(0,i.jsxs)(n.p,{children:["Elimina un an\xe1lisis por su ID.",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Disponible para:"})," ",(0,i.jsx)(n.code,{children:"ADMIN"})]}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros-2",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id"}),": ID num\xe9rico del an\xe1lisis."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"respuestas-4",children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Eliminaci\xf3n exitosa."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": Acceso denegado."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ejemplo-de-uso-post",children:"\ud83e\uddea Ejemplo de uso (POST)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'// Crear an\xe1lisis nutricional (tipo INDIVIDUAL)\r\nfetch("/nutriscan", {\r\n  method: "POST",\r\n  headers: {\r\n    "Authorization": "Bearer <token>",\r\n    "Content-Type": "application/json"\r\n  },\r\n  body: JSON.stringify({\r\n    consulta: "Arroz integral",\r\n    esAlimento: true,\r\n    respuesta: {},\r\n    tipoAnalisis: "ocr-gpt-only"\r\n  })\r\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-resumen-de-m\xe9todos",children:"\ud83d\udce6 Resumen de m\xe9todos"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"M\xe9todo"}),(0,i.jsx)(n.th,{children:"Ruta"}),(0,i.jsx)(n.th,{children:"Descripci\xf3n"}),(0,i.jsx)(n.th,{children:"Autorizado para"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/nutriscan"})}),(0,i.jsx)(n.td,{children:"Crear un nuevo an\xe1lisis"}),(0,i.jsx)(n.td,{children:"INDIVIDUAL, ADMIN, DEV"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/nutriscan"})}),(0,i.jsx)(n.td,{children:"Obtener an\xe1lisis seg\xfan rol"}),(0,i.jsx)(n.td,{children:"ADMIN, DESARROLLADOR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/nutriscan/usuario/{id}"})}),(0,i.jsx)(n.td,{children:"Ver an\xe1lisis de un usuario espec\xedfico"}),(0,i.jsx)(n.td,{children:"ADMIN"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PUT"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/nutriscan/{id}"})}),(0,i.jsx)(n.td,{children:"Actualizar un an\xe1lisis"}),(0,i.jsx)(n.td,{children:"ADMIN"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DELETE"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/nutriscan/{id}"})}),(0,i.jsx)(n.td,{children:"Eliminar un an\xe1lisis"}),(0,i.jsx)(n.td,{children:"ADMIN"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var r=s(6540);const i={},d=r.createContext(i);function c(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);