"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1867],{4638:(e,r,d)=>{d.r(r),d.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"backend/middleware/uploadCloudinary","title":"Middleware uploadCloudinary","description":"Este middleware configura la subida de archivos (im\xe1genes) al servicio en la nube Cloudinary, utilizando multer como gestor de archivos. Centraliza toda la l\xf3gica para almacenar im\xe1genes de forma estructurada y optimizada en carpetas espec\xedficas de tu cuenta Cloudinary.","source":"@site/docs/backend/middleware/uploadCloudinary.md","sourceDirName":"backend/middleware","slug":"/backend/middleware/uploadCloudinary","permalink":"/producttrack/docs/backend/middleware/uploadCloudinary","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/middleware/uploadCloudinary.md","tags":[],"version":"current","frontMatter":{"id":"uploadCloudinary","title":"Middleware uploadCloudinary","sidebar_label":"UploadCloudinary"},"sidebar":"tutorialSidebar","previous":{"title":"Token","permalink":"/producttrack/docs/backend/middleware/token.middleware"},"next":{"title":"uploadMemory","permalink":"/producttrack/docs/backend/middleware/uploadMemory"}}');var a=d(4848),i=d(8453);const l={id:"uploadCloudinary",title:"Middleware uploadCloudinary",sidebar_label:"UploadCloudinary"},s="Middleware: uploadCloudinary.ts",c={},o=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udccc Prop\xf3sito",id:"-prop\xf3sito",level:2},{value:"\ud83d\udee0\ufe0f Dependencias utilizadas",id:"\ufe0f-dependencias-utilizadas",level:2},{value:"\ud83d\udd10 Carga de variables de entorno",id:"-carga-de-variables-de-entorno",level:2},{value:"\u2601\ufe0f Configuraci\xf3n de Cloudinary",id:"\ufe0f-configuraci\xf3n-de-cloudinary",level:2},{value:"\ud83d\udce6 Configuraci\xf3n del almacenamiento en Cloudinary",id:"-configuraci\xf3n-del-almacenamiento-en-cloudinary",level:2},{value:"\ud83d\ude80 Exportaci\xf3n del middleware",id:"-exportaci\xf3n-del-middleware",level:2},{value:"\u2705 Ejemplo de uso en rutas",id:"-ejemplo-de-uso-en-rutas",level:2},{value:"\ud83d\udcdd Resumen",id:"-resumen",level:2},{value:"\ud83e\udde0 Notas adicionales",id:"-notas-adicionales",level:2}];function t(e){const r={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"middleware-uploadcloudinaryts",children:"Middleware: uploadCloudinary.ts"})}),"\n",(0,a.jsxs)(r.p,{children:["Este middleware configura ",(0,a.jsx)(r.strong,{children:"la subida de archivos (im\xe1genes)"})," al servicio en la nube ",(0,a.jsx)(r.strong,{children:"Cloudinary"}),", utilizando ",(0,a.jsx)(r.code,{children:"multer"})," como gestor de archivos. Centraliza toda la l\xf3gica para almacenar im\xe1genes de forma estructurada y optimizada en carpetas espec\xedficas de tu cuenta Cloudinary."]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.code,{children:"src/middleware/uploadCloudinary.ts"})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-prop\xf3sito",children:"\ud83d\udccc Prop\xf3sito"}),"\n",(0,a.jsx)(r.p,{children:"Permitir que los usuarios suban im\xe1genes (por ejemplo, fotos de perfil) que se almacenar\xe1n directamente en Cloudinary. Este middleware puede integrarse f\xe1cilmente con rutas protegidas y garantiza un manejo seguro y organizado de archivos."}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"\ufe0f-dependencias-utilizadas",children:"\ud83d\udee0\ufe0f Dependencias utilizadas"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"import dotenv from 'dotenv';\r\nimport path from 'path';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { CloudinaryStorage } from 'multer-storage-cloudinary';\r\nimport multer from 'multer';\n"})}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"Paquete"}),(0,a.jsx)(r.th,{children:"Prop\xf3sito"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"dotenv"})}),(0,a.jsxs)(r.td,{children:["Carga las variables de entorno desde un archivo ",(0,a.jsx)(r.code,{children:".env"}),"."]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"path"})}),(0,a.jsx)(r.td,{children:"Facilita rutas absolutas para cargar archivos correctamente."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"cloudinary"})}),(0,a.jsx)(r.td,{children:"Cliente oficial de la API de Cloudinary."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"multer-storage-cloudinary"})}),(0,a.jsx)(r.td,{children:"Adaptador de almacenamiento entre Multer y Cloudinary."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"multer"})}),(0,a.jsxs)(r.td,{children:["Middleware para manejar archivos tipo ",(0,a.jsx)(r.code,{children:"multipart/form-data"}),"."]})]})]})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-carga-de-variables-de-entorno",children:"\ud83d\udd10 Carga de variables de entorno"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"dotenv.config({ path: path.resolve(__dirname, '../../.env') });\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Esto asegura que las variables del archivo ",(0,a.jsx)(r.code,{children:".env"})," sean cargadas correctamente incluso si se ejecuta desde otro directorio."]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsx)(r.p,{children:"\u2705 \xdatil en producci\xf3n o ambientes donde el punto de entrada puede variar."}),"\n"]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"\ufe0f-configuraci\xf3n-de-cloudinary",children:"\u2601\ufe0f Configuraci\xf3n de Cloudinary"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"cloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME!,\r\n  api_key: process.env.CLOUDINARY_API_KEY!,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET!,\r\n});\n"})}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"Variable del entorno"}),(0,a.jsx)(r.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"CLOUDINARY_CLOUD_NAME"})}),(0,a.jsx)(r.td,{children:"Nombre del espacio en Cloudinary."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"CLOUDINARY_API_KEY"})}),(0,a.jsx)(r.td,{children:"Clave p\xfablica de la API."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"CLOUDINARY_API_SECRET"})}),(0,a.jsx)(r.td,{children:"Clave secreta para autenticaci\xf3n."})]})]})]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:["\u26a0\ufe0f ",(0,a.jsxs)(r.em,{children:["Aseg\xfarate de que estas variables est\xe9n correctamente configuradas en tu archivo ",(0,a.jsx)(r.code,{children:".env"}),"."]})]}),"\n"]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-configuraci\xf3n-del-almacenamiento-en-cloudinary",children:"\ud83d\udce6 Configuraci\xf3n del almacenamiento en Cloudinary"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"const storage = new CloudinaryStorage({\r\n  cloudinary,\r\n  params: async () => ({\r\n    folder: 'producttrack/perfiles',\r\n    allowed_formats: ['jpg', 'png', 'jpeg', 'webp'],\r\n    transformation: [{ width: 500, height: 500, crop: 'limit' }],\r\n  }),\r\n});\n"})}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"Propiedad"}),(0,a.jsx)(r.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"folder"})}),(0,a.jsxs)(r.td,{children:["Carpeta destino en Cloudinary: ",(0,a.jsx)(r.code,{children:"producttrack/perfiles"}),"."]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"allowed_formats"})}),(0,a.jsxs)(r.td,{children:["Solo se permiten im\xe1genes en ",(0,a.jsx)(r.code,{children:"jpg"}),", ",(0,a.jsx)(r.code,{children:"png"}),", ",(0,a.jsx)(r.code,{children:"jpeg"})," y ",(0,a.jsx)(r.code,{children:"webp"}),"."]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"transformation"})}),(0,a.jsx)(r.td,{children:"Redimensiona la imagen a un m\xe1ximo de 500x500px sin recorte forzado."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"params"})}),(0,a.jsx)(r.td,{children:"Funci\xf3n as\xedncrona que retorna los par\xe1metros din\xe1micamente por archivo."})]})]})]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:["\ud83c\udfaf Usar ",(0,a.jsx)(r.code,{children:"params"})," como funci\xf3n permite l\xf3gica condicional futura seg\xfan el archivo o usuario."]}),"\n"]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-exportaci\xf3n-del-middleware",children:"\ud83d\ude80 Exportaci\xf3n del middleware"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"export const uploadCloudinary = multer({ storage });\n"})}),"\n",(0,a.jsx)(r.p,{children:"Puedes usarlo directamente en rutas del backend como middleware para manejar la subida de archivos."}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-ejemplo-de-uso-en-rutas",children:"\u2705 Ejemplo de uso en rutas"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:'import { uploadCloudinary } from "../middleware/uploadCloudinary";\r\n\r\nrouter.post("/perfil/foto", uploadCloudinary.single("imagen"), controlador.subirFoto);\n'})}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"M\xe9todo"}),(0,a.jsx)(r.th,{children:"Explicaci\xf3n"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:'uploadCloudinary.single("imagen")'})}),(0,a.jsxs)(r.td,{children:["Procesa un solo archivo bajo el campo ",(0,a.jsx)(r.code,{children:'"imagen"'})," del formulario."]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:'uploadCloudinary.array("fotos")'})}),(0,a.jsx)(r.td,{children:"Para subir m\xfaltiples im\xe1genes."})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"uploadCloudinary.fields([...])"})}),(0,a.jsx)(r.td,{children:"Para manejar m\xfaltiples campos con archivos diferentes."})]})]})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-resumen",children:"\ud83d\udcdd Resumen"}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"Elemento"}),(0,a.jsx)(r.th,{children:"Valor"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"Almacenamiento"}),(0,a.jsxs)(r.td,{children:["Cloudinary (",(0,a.jsx)(r.code,{children:"producttrack/perfiles"}),")"]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"Middleware de subida"}),(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"multer"})})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"Archivos permitidos"}),(0,a.jsxs)(r.td,{children:[(0,a.jsx)(r.code,{children:".jpg"}),", ",(0,a.jsx)(r.code,{children:".png"}),", ",(0,a.jsx)(r.code,{children:".jpeg"}),", ",(0,a.jsx)(r.code,{children:".webp"})]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"Transformaci\xf3n"}),(0,a.jsxs)(r.td,{children:["M\xe1ximo 500x500 px (",(0,a.jsx)(r.code,{children:"crop: limit"}),")"]})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"Nombre exportado"}),(0,a.jsx)(r.td,{children:(0,a.jsx)(r.code,{children:"uploadCloudinary"})})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"Flexibilidad de l\xf3gica"}),(0,a.jsxs)(r.td,{children:["Alta (con ",(0,a.jsx)(r.code,{children:"params"})," as\xedncrono)"]})]})]})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-notas-adicionales",children:"\ud83e\udde0 Notas adicionales"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"No es necesario crear manualmente la carpeta en Cloudinary."}),"\n",(0,a.jsx)(r.li,{children:"Las im\xe1genes subidas devuelven una URL p\xfablica para ser usada directamente en el frontend."}),"\n",(0,a.jsxs)(r.li,{children:["Puedes modificar el nombre de la carpeta, formatos permitidos o agregar marcas de agua desde ",(0,a.jsx)(r.code,{children:"params"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,r,d)=>{d.d(r,{R:()=>l,x:()=>s});var n=d(6540);const a={},i=n.createContext(a);function l(e){const r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);