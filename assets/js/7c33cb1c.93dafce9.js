"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4224],{6809:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"backend/services/log.service","title":"Servicio Log","description":"Este servicio gestiona el inicio de sesi\xf3n de usuarios, validando sus credenciales y generando un token JWT seguro. Tambi\xe9n identifica si un usuario del rol EQUIPO debe completar su perfil.","source":"@site/docs/backend/services/log.service.md","sourceDirName":"backend/services","slug":"/backend/services/log.service","permalink":"/producttrack/docs/backend/services/log.service","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/services/log.service.md","tags":[],"version":"current","frontMatter":{"id":"log.service","title":"Servicio Log","sidebar_label":"Log Service"},"sidebar":"tutorialSidebar","previous":{"title":"GPTService","permalink":"/producttrack/docs/backend/services/gpt.service"},"next":{"title":"NutriScanService","permalink":"/producttrack/docs/backend/services/nutriscan.service"}}');var i=r(4848),c=r(8453);const l={id:"log.service",title:"Servicio Log",sidebar_label:"Log Service"},o="Log Service",a={},d=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udce6 Dependencias",id:"-dependencias",level:2},{value:"\ud83e\udde9 Clase: <code>LogService</code>",id:"-clase-logservice",level:2},{value:"\ud83d\udd10 <code>async login(correo: string, password: string)</code>",id:"-async-logincorreo-string-password-string",level:3},{value:"Par\xe1metros:",id:"par\xe1metros",level:4},{value:"Retorna:",id:"retorna",level:4},{value:"Lanza:",id:"lanza",level:4},{value:"\ud83e\uddea Funci\xf3n auxiliar: <code>validarCredenciales</code>",id:"-funci\xf3n-auxiliar-validarcredenciales",level:2},{value:"Par\xe1metros:",id:"par\xe1metros-1",level:4},{value:"Retorna:",id:"retorna-1",level:4},{value:"\u2705 Ejemplo de uso",id:"-ejemplo-de-uso",level:2},{value:"\ud83d\udd10 Seguridad",id:"-seguridad",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"log-service",children:"Log Service"})}),"\n",(0,i.jsxs)(n.p,{children:["Este servicio gestiona el ",(0,i.jsx)(n.strong,{children:"inicio de sesi\xf3n"})," de usuarios, validando sus credenciales y generando un token JWT seguro. Tambi\xe9n identifica si un usuario del rol ",(0,i.jsx)(n.code,{children:"EQUIPO"})," debe completar su perfil."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"src/services/log.service.ts"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-dependencias",children:"\ud83d\udce6 Dependencias"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/bcryptjs",children:(0,i.jsx)(n.code,{children:"bcryptjs"})}),": Para comparar contrase\xf1as hasheadas."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/jsonwebtoken",children:(0,i.jsx)(n.code,{children:"jsonwebtoken"})}),": Para generar tokens JWT."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"prisma"}),": Cliente para interactuar con la base de datos."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Variables importadas desde ",(0,i.jsx)(n.code,{children:"config/token"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"JWT_SECRET"}),": Secreto para firmar el token."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TOKEN_EXPIRES_IN"}),": Tiempo de expiraci\xf3n del token."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"-clase-logservice",children:["\ud83e\udde9 Clase: ",(0,i.jsx)(n.code,{children:"LogService"})]}),"\n",(0,i.jsxs)(n.h3,{id:"-async-logincorreo-string-password-string",children:["\ud83d\udd10 ",(0,i.jsx)(n.code,{children:"async login(correo: string, password: string)"})]}),"\n",(0,i.jsx)(n.p,{children:"Realiza el proceso de autenticaci\xf3n con los siguientes pasos:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Buscar el usuario"})," en la base de datos por correo electr\xf3nico."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verificar que el usuario exista"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Comparar contrase\xf1as"})," (la ingresada con la hasheada en BD)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Generar token JWT"})," con campos clave del usuario:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"id"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"rol"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tipoUsuario"})," (opcional)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rolEquipo"})," (opcional)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verificar perfil incompleto"})," si el usuario tiene rol ",(0,i.jsx)(n.code,{children:'"EQUIPO"'}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Se considera incompleto si le falta ",(0,i.jsx)(n.code,{children:"telefono"})," o ",(0,i.jsx)(n.code,{children:"direccion"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"correo"}),": Email del usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"password"}),": Contrase\xf1a en texto plano."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"retorna",children:"Retorna:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"{\r\n  user,                    // Objeto del usuario autenticado\r\n  token,                   // Token JWT v\xe1lido por el tiempo definido\r\n  requiereCompletarPerfil // true | false seg\xfan los datos del usuario\r\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"lanza",children:"Lanza:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'Error("Usuario no encontrado")'})," si el correo no est\xe1 en BD."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'Error("Contrase\xf1a incorrecta")'})," si la contrase\xf1a no coincide."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"-funci\xf3n-auxiliar-validarcredenciales",children:["\ud83e\uddea Funci\xf3n auxiliar: ",(0,i.jsx)(n.code,{children:"validarCredenciales"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"export const validarCredenciales = async (email: string, password: string)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Esta funci\xf3n es una forma directa de invocar el servicio ",(0,i.jsx)(n.code,{children:"login"}),", \xfatil para controladores."]}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros-1",children:"Par\xe1metros:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"email"}),": Correo electr\xf3nico del usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"password"}),": Contrase\xf1a en texto plano."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"retorna-1",children:"Retorna:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["El mismo objeto que ",(0,i.jsx)(n.code,{children:"login()"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ejemplo-de-uso",children:"\u2705 Ejemplo de uso"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'const { user, token, requiereCompletarPerfil } = await validarCredenciales("correo@ejemplo.com", "secreta123");\r\n\r\nif (requiereCompletarPerfil) {\r\n  console.log("El perfil debe ser completado.");\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-seguridad",children:"\ud83d\udd10 Seguridad"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No se expone nunca la contrase\xf1a en las respuestas."}),"\n",(0,i.jsx)(n.li,{children:"El token solo contiene datos necesarios para la sesi\xf3n del usuario."}),"\n",(0,i.jsx)(n.li,{children:"El rol y tipo de usuario pueden ser utilizados para control de acceso."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var s=r(6540);const i={},c=s.createContext(i);function l(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);