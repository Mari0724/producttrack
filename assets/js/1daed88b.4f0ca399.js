"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9512],{4444:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"backend/services/gpt.service","title":"Servicio GPT","description":"Este servicio maneja la interacci\xf3n con OpenAI GPT para generar mensajes nutricionales personalizados a partir de la informaci\xf3n obtenida de productos analizados con NutriScan. Funciona como un asistente nutricional digital que transforma datos num\xe9ricos en recomendaciones o res\xfamenes comprensibles.","source":"@site/docs/backend/services/gpt.service.md","sourceDirName":"backend/services","slug":"/backend/services/gpt.service","permalink":"/producttrack/docs/backend/services/gpt.service","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/services/gpt.service.md","tags":[],"version":"current","frontMatter":{"id":"gpt.service","title":"Servicio GPT","sidebar_label":"GPT"},"sidebar":"tutorialSidebar","previous":{"title":"Equipo Service","permalink":"/producttrack/docs/backend/services/equipo.service"},"next":{"title":"Log Service","permalink":"/producttrack/docs/backend/services/log.service"}}');var i=r(4848),a=r(8453);const o={id:"gpt.service",title:"Servicio GPT",sidebar_label:"GPT"},c=void 0,d={},l=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udccc Prop\xf3sito",id:"-prop\xf3sito",level:2},{value:"\ud83e\udde9 Importaciones clave",id:"-importaciones-clave",level:2},{value:"\ud83d\udd10 Validaci\xf3n de clave API",id:"-validaci\xf3n-de-clave-api",level:2},{value:"\u26a0\ufe0f Modo simulaci\xf3n",id:"\ufe0f-modo-simulaci\xf3n",level:2},{value:"\ud83e\udde0 Clase: <code>GPTService</code>",id:"-clase-gptservice",level:2},{value:"M\xe9todo: <code>generarMensajeNutricional(nombreProducto: string, resultados: any[]): Promise&lt;string&gt;</code>",id:"m\xe9todo-generarmensajenutricionalnombreproducto-string-resultados-any-promisestring",level:3},{value:"\u2705 Prop\xf3sito",id:"-prop\xf3sito-1",level:4},{value:"\ud83d\udce5 Par\xe1metros",id:"-par\xe1metros",level:4},{value:"\ud83d\udce4 Retorna",id:"-retorna",level:4},{value:"\ud83e\udd16 Estructura del prompt",id:"-estructura-del-prompt",level:2},{value:"\ud83d\udce6 Manejador de errores",id:"-manejador-de-errores",level:2},{value:"\ud83d\ude80 Instancia exportada",id:"-instancia-exportada",level:2},{value:"\ud83d\udcdd Resumen",id:"-resumen",level:2},{value:"\ud83e\udde0 Notas adicionales",id:"-notas-adicionales",level:2}];function t(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Este servicio maneja la interacci\xf3n con ",(0,i.jsx)(n.strong,{children:"OpenAI GPT"})," para generar mensajes nutricionales personalizados a partir de la informaci\xf3n obtenida de productos analizados con NutriScan. Funciona como un asistente nutricional digital que transforma datos num\xe9ricos en recomendaciones o res\xfamenes comprensibles."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"src/services/gpt.service.ts"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-prop\xf3sito",children:"\ud83d\udccc Prop\xf3sito"}),"\n",(0,i.jsxs)(n.p,{children:["Generar un ",(0,i.jsx)(n.strong,{children:"mensaje descriptivo y personalizado"})," que resume la informaci\xf3n nutricional de un producto alimenticio utilizando un modelo de lenguaje de OpenAI (",(0,i.jsx)(n.code,{children:"gpt-3.5-turbo"}),")."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-importaciones-clave",children:"\ud83e\udde9 Importaciones clave"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import OpenAI from "openai";\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Se importa el cliente oficial para interactuar con la API de OpenAI."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-validaci\xf3n-de-clave-api",children:"\ud83d\udd10 Validaci\xf3n de clave API"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const apiKey = process.env.OPENAI_API_KEY;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Se obtiene la clave desde el archivo ",(0,i.jsx)(n.code,{children:".env"}),". Si no se encuentra, el sistema ",(0,i.jsx)(n.strong,{children:"emitir\xe1 una advertencia"})," y funcionar\xe1 con respuestas simuladas. En ese caso:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No lanza un error ni interrumpe la ejecuci\xf3n."}),"\n",(0,i.jsx)(n.li,{children:"Retorna un mensaje simple basado en los datos locales disponibles del producto (como calor\xedas y az\xfacares)."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Esto permite que el sistema contin\xfae funcionando aunque la clave de OpenAI no est\xe9 configurada.."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-modo-simulaci\xf3n",children:"\u26a0\ufe0f Modo simulaci\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'if (!apiKey) {\r\n  console.warn("\u26a0\ufe0f No se encontr\xf3 la clave de OpenAI. Se usar\xe1n respuestas simuladas.");\r\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\ud83d\udd12 El sistema se adapta autom\xe1ticamente si no hay clave API. A\xfan puede entregar mensajes predeterminados basados en los datos."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"-clase-gptservice",children:["\ud83e\udde0 Clase: ",(0,i.jsx)(n.code,{children:"GPTService"})]}),"\n",(0,i.jsxs)(n.h3,{id:"m\xe9todo-generarmensajenutricionalnombreproducto-string-resultados-any-promisestring",children:["M\xe9todo: ",(0,i.jsx)(n.code,{children:"generarMensajeNutricional(nombreProducto: string, resultados: any[]): Promise<string>"})]}),"\n",(0,i.jsx)(n.h4,{id:"-prop\xf3sito-1",children:"\u2705 Prop\xf3sito"}),"\n",(0,i.jsx)(n.p,{children:"Generar un resumen nutricional del producto utilizando GPT, con base en los valores encontrados en la base de datos o resultado OCR/OpenFoodFacts."}),"\n",(0,i.jsx)(n.h4,{id:"-par\xe1metros",children:"\ud83d\udce5 Par\xe1metros"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Nombre"}),(0,i.jsx)(n.th,{children:"Tipo"}),(0,i.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"nombreProducto"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"Nombre del producto ingresado o reconocido."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resultados"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"any[]"})}),(0,i.jsx)(n.td,{children:"Array con la informaci\xf3n nutricional procesada del producto."})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"-retorna",children:"\ud83d\udce4 Retorna"}),"\n",(0,i.jsxs)(n.p,{children:["Una ",(0,i.jsx)(n.code,{children:"Promise<string>"})," que contiene el ",(0,i.jsx)(n.strong,{children:"mensaje generado"}),' o un texto alternativo si no hay conexi\xf3n con GPT.\r\nEl mensaje es generado desde completion.choices[0].message?.content. Si por alg\xfan motivo GPT no devuelve contenido v\xe1lido, se retorna el texto:\r\n"No se pudo generar el mensaje.']}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-estructura-del-prompt",children:"\ud83e\udd16 Estructura del prompt"}),"\n",(0,i.jsx)(n.p,{children:"El mensaje enviado a GPT incluye:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Calor\xedas"}),"\n",(0,i.jsx)(n.li,{children:"Az\xfacares"}),"\n",(0,i.jsx)(n.li,{children:"Grasas (totales, saturadas, trans)"}),"\n",(0,i.jsx)(n.li,{children:"Sodio"}),"\n",(0,i.jsx)(n.li,{children:"Fibra"}),"\n",(0,i.jsx)(n.li,{children:"Prote\xednas"}),"\n",(0,i.jsx)(n.li,{children:"Nutriscore"}),"\n",(0,i.jsx)(n.li,{children:"Grupo NOVA"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Ejemplo parcial del ",(0,i.jsx)(n.code,{children:"prompt"})," generado:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'const prompt = `\r\nEres un nutricionista digital. Tienes la siguiente informaci\xf3n nutricional para un producto llamado "${producto.nombre}":\r\n\r\n- Calor\xedas: 340 kcal\r\n- Az\xfacares: 15 g\r\n...\r\nRedacta un mensaje para el usuario resumiendo esta informaci\xf3n.\r\n`;\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\ud83d\udca1 Se utiliza ",(0,i.jsx)(n.code,{children:"temperature: 0.6"})," para equilibrar creatividad y precisi\xf3n."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-manejador-de-errores",children:"\ud83d\udce6 Manejador de errores"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'catch (error: any) {\r\n  console.error("\u274c Error generando mensaje nutricional:", error);\r\n  throw new Error(...);\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Muestra el error en consola y lanza una excepci\xf3n legible para otros servicios del backend."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-instancia-exportada",children:"\ud83d\ude80 Instancia exportada"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"export const gptService = new GPTService();\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Se exporta una instancia \xfanica de ",(0,i.jsx)(n.code,{children:"GPTService"})," lista para usarse en controladores u otros servicios."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-resumen",children:"\ud83d\udcdd Resumen"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Elemento"}),(0,i.jsx)(n.th,{children:"Detalle"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Modelo GPT utilizado"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"gpt-3.5-turbo"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Dependencia cr\xedtica"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"OPENAI_API_KEY"})," en ",(0,i.jsx)(n.code,{children:".env"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Modo fallback"}),(0,i.jsx)(n.td,{children:"S\xed (respuestas simuladas sin GPT)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Uso principal"}),(0,i.jsx)(n.td,{children:"Generar mensaje nutricional a partir de datos"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Exportaci\xf3n"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"gptService"})," como singleton"]})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-notas-adicionales",children:"\ud83e\udde0 Notas adicionales"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Apto para extenderse con otros modelos como ",(0,i.jsx)(n.code,{children:"gpt-4"})," si se requiere."]}),"\n",(0,i.jsxs)(n.li,{children:["Ideal para integrarse con rutas como ",(0,i.jsx)(n.code,{children:"/nutriscan-ocr"})," y ",(0,i.jsx)(n.code,{children:"/confirmar-nombre"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si el array ",(0,i.jsx)(n.code,{children:"resultados"})," est\xe1 vac\xedo, se devuelve un mensaje explicativo al usuario."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var s=r(6540);const i={},a=s.createContext(i);function o(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);