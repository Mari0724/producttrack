"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[715],{7163:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"backend/utils/jwt","title":"jwt","description":"Este m\xf3dulo define la funci\xf3n expressAuthentication, que permite validar tokens JWT en las solicitudes HTTP de Express. Es utilizado principalmente por tsoa para proteger rutas con autenticaci\xf3n. Extrae el token desde la cabecera Authorization, lo verifica con la clave secreta y devuelve el payload decodificado si es v\xe1lido.","source":"@site/docs/backend/utils/jwt.md","sourceDirName":"backend/utils","slug":"/backend/utils/jwt","permalink":"/producttrack/docs/backend/utils/jwt","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/utils/jwt.md","tags":[],"version":"current","frontMatter":{"id":"jwt","title":"jwt","sidebar_label":"Autentificacion jwt"},"sidebar":"tutorialSidebar","previous":{"title":"cloudinary","permalink":"/producttrack/docs/backend/utils/utils-cloudinary"},"next":{"title":"ocr","permalink":"/producttrack/docs/backend/utils/utils-ocr"}}');var r=i(4848),t=i(8453);const c={id:"jwt",title:"jwt",sidebar_label:"Autentificacion jwt"},o="Autenticaci\xf3n JWT",d={},l=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udd10 Funci\xf3n: <code>expressAuthentication</code>",id:"-funci\xf3n-expressauthentication",level:2},{value:"\u2705 Prop\xf3sito:",id:"-prop\xf3sito",level:3},{value:"\ud83d\udce5 Par\xe1metros:",id:"-par\xe1metros",level:3},{value:"\ud83d\udce4 Retorno:",id:"-retorno",level:3},{value:"\ud83d\udd0d Comportamiento:",id:"-comportamiento",level:3},{value:"\ud83d\udd10 Requisitos:",id:"-requisitos",level:3},{value:"\ud83e\udde0 Ejemplo de uso con TSOA:",id:"-ejemplo-de-uso-con-tsoa",level:3},{value:"\ud83d\udce6 Dependencias:",id:"-dependencias",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"autenticaci\xf3n-jwt",children:"Autenticaci\xf3n JWT"})}),"\n",(0,r.jsxs)(n.p,{children:["Este m\xf3dulo define la funci\xf3n ",(0,r.jsx)(n.code,{children:"expressAuthentication"}),", que permite validar tokens JWT en las solicitudes HTTP de Express. Es utilizado principalmente por ",(0,r.jsx)(n.code,{children:"tsoa"})," para proteger rutas con autenticaci\xf3n. Extrae el token desde la cabecera ",(0,r.jsx)(n.code,{children:"Authorization"}),", lo verifica con la clave secreta y devuelve el payload decodificado si es v\xe1lido."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"src/utils/jwt.ts"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"-funci\xf3n-expressauthentication",children:["\ud83d\udd10 Funci\xf3n: ",(0,r.jsx)(n.code,{children:"expressAuthentication"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export async function expressAuthentication(\r\n  request: Request,\r\n  securityName: string,\r\n  scopes?: string[]\r\n): Promise<any>\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-prop\xf3sito",children:"\u2705 Prop\xf3sito:"}),"\n",(0,r.jsxs)(n.p,{children:["Autentica una solicitud HTTP usando el token JWT incluido en la cabecera ",(0,r.jsx)(n.code,{children:"Authorization"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-par\xe1metros",children:"\ud83d\udce5 Par\xe1metros:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Nombre"}),(0,r.jsx)(n.th,{children:"Tipo"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Request"})}),(0,r.jsx)(n.td,{children:"Objeto de solicitud de Express."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"securityName"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})}),(0,r.jsxs)(n.td,{children:["Nombre del esquema de seguridad (usualmente ",(0,r.jsx)(n.code,{children:'"jwt"'})," en ",(0,r.jsx)(n.code,{children:"tsoa.json"}),")."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"scopes"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string[]?"})}),(0,r.jsx)(n.td,{children:"Lista opcional de permisos o roles requeridos para acceder a la ruta."})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-retorno",children:"\ud83d\udce4 Retorno:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Devuelve el contenido decodificado del token si es v\xe1lido (ej. ",(0,r.jsx)(n.code,{children:"id"}),", ",(0,r.jsx)(n.code,{children:"rol"}),", ",(0,r.jsx)(n.code,{children:"correo"}),", etc.)."]}),"\n",(0,r.jsx)(n.li,{children:"Si el token es inv\xe1lido, faltante o expirado, lanza un error con un mensaje claro."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-comportamiento",children:"\ud83d\udd0d Comportamiento:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Verifica que la cabecera ",(0,r.jsx)(n.code,{children:"Authorization"})," exista y comience con ",(0,r.jsx)(n.code,{children:"Bearer "}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Extrae el token y lo valida con ",(0,r.jsx)(n.code,{children:"jwt.verify"})," usando la clave ",(0,r.jsx)(n.code,{children:"JWT_SECRET"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Si es v\xe1lido, el contenido del token se retorna y puede ser utilizado por la app (ej. se asigna a ",(0,r.jsx)(n.code,{children:"request['user']"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Si es inv\xe1lido, lanza un error manejable."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-requisitos",children:"\ud83d\udd10 Requisitos:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Variable ",(0,r.jsx)(n.code,{children:"JWT_SECRET"})," definida en ",(0,r.jsx)(n.code,{children:"config/token.ts"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Token JWT firmado correctamente con el mismo secreto."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-ejemplo-de-uso-con-tsoa",children:"\ud83e\udde0 Ejemplo de uso con TSOA:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'@Security("jwt")\r\n@Get("/usuarios/perfil")\r\npublic async obtenerPerfil(@Request() req: Express.Request) {\r\n  const usuario = req[\'user\']; // \u2190 contiene datos del token\r\n  return this.usuarioService.obtenerPorId(usuario.id);\r\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-dependencias",children:"\ud83d\udce6 Dependencias:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/jsonwebtoken",children:(0,r.jsx)(n.code,{children:"jsonwebtoken"})}),": para verificar el token."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://expressjs.com/",children:(0,r.jsx)(n.code,{children:"express"})}),": para manejar el objeto de solicitud."]}),"\n",(0,r.jsxs)(n.li,{children:["Clave secreta (",(0,r.jsx)(n.code,{children:"JWT_SECRET"}),") importada desde configuraci\xf3n."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);