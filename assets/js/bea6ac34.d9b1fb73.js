"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4316],{8453:(e,a,r)=>{r.d(a,{R:()=>o,x:()=>s});var n=r(6540);const i={},d=n.createContext(i);function o(e){const a=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function s(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(d.Provider,{value:a},e.children)}},9334:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"backend/middleware/allCloudinaryUploads","title":"Middleware de Subida a Cloudinary","description":"Este middleware configura dos manejadores de subida de archivos a Cloudinary utilizando la librer\xeda multer-storage-cloudinary. Se definen dos destinos distintos: uno para im\xe1genes de productos y otro para im\xe1genes de perfil de usuario, cada uno con su configuraci\xf3n respectiva.","source":"@site/docs/backend/middleware/allCloudinaryUploads.md","sourceDirName":"backend/middleware","slug":"/backend/middleware/allCloudinaryUploads","permalink":"/producttrack/docs/backend/middleware/allCloudinaryUploads","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/middleware/allCloudinaryUploads.md","tags":[],"version":"current","frontMatter":{"id":"allCloudinaryUploads","title":"Middleware de Subida a Cloudinary","sidebar_label":"Subidas a Cloudinary"},"sidebar":"tutorialSidebar","previous":{"title":"Log Interface","permalink":"/producttrack/docs/backend/interfaces/log.interface"},"next":{"title":"historial","permalink":"/producttrack/docs/backend/middleware/historial"}}');var i=r(4848),d=r(8453);const o={id:"allCloudinaryUploads",title:"Middleware de Subida a Cloudinary",sidebar_label:"Subidas a Cloudinary"},s=void 0,l={},c=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udce6 Dependencias utilizadas",id:"-dependencias-utilizadas",level:2},{value:"\u2699\ufe0f Configuraci\xf3n de Cloudinary",id:"\ufe0f-configuraci\xf3n-de-cloudinary",level:2},{value:"\ud83d\uddc2\ufe0f Configuraci\xf3n de almacenamiento",id:"\ufe0f-configuraci\xf3n-de-almacenamiento",level:2},{value:"\ud83d\udcc1 Almacenamiento para productos",id:"-almacenamiento-para-productos",level:3},{value:"\ud83d\udc64 Almacenamiento para perfiles",id:"-almacenamiento-para-perfiles",level:3},{value:"\ud83d\ude80 Exportaci\xf3n de middlewares",id:"-exportaci\xf3n-de-middlewares",level:2},{value:"\u2705 Ejemplo de uso en rutas",id:"-ejemplo-de-uso-en-rutas",level:2},{value:"\ud83d\udd10 Recomendaciones",id:"-recomendaciones",level:2}];function t(e){const a={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.p,{children:"Este middleware configura dos manejadores de subida de archivos a Cloudinary utilizando la librer\xeda multer-storage-cloudinary. Se definen dos destinos distintos: uno para im\xe1genes de productos y otro para im\xe1genes de perfil de usuario, cada uno con su configuraci\xf3n respectiva."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,i.jsx)(a.p,{children:(0,i.jsx)(a.code,{children:"src/middleware/allCloudinaryUploads.ts"})}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-dependencias-utilizadas",children:"\ud83d\udce6 Dependencias utilizadas"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:"import { v2 as cloudinary } from 'cloudinary';\r\nimport { CloudinaryStorage } from 'multer-storage-cloudinary';\r\nimport multer from 'multer';\n"})}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"dotenv: para cargar variables de entorno desde config/env."}),"\n",(0,i.jsx)(a.li,{children:"cloudinary: cliente oficial de Cloudinary."}),"\n",(0,i.jsx)(a.li,{children:"multer-storage-cloudinary: adaptador para usar Cloudinary como almacenamiento de multer."}),"\n",(0,i.jsx)(a.li,{children:"multer: middleware de manejo de archivos para Express."}),"\n"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"\ufe0f-configuraci\xf3n-de-cloudinary",children:"\u2699\ufe0f Configuraci\xf3n de Cloudinary"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:"cloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\n"})}),"\n",(0,i.jsx)(a.p,{children:"Carga las credenciales necesarias desde las variables de entorno (.env)."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"\ufe0f-configuraci\xf3n-de-almacenamiento",children:"\ud83d\uddc2\ufe0f Configuraci\xf3n de almacenamiento"}),"\n",(0,i.jsx)(a.p,{children:"Se definen dos instancias de CloudinaryStorage para organizar im\xe1genes en carpetas separadas:"}),"\n",(0,i.jsx)(a.h3,{id:"-almacenamiento-para-productos",children:"\ud83d\udcc1 Almacenamiento para productos"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:"const storageProductos = new CloudinaryStorage({\r\n  cloudinary,\r\n  params: async () => ({\r\n    folder: 'producttrack/productos',\r\n    allowed_formats: ['jpg', 'png', 'jpeg', 'webp'],\r\n    transformation: [{ width: 500, height: 500, crop: 'limit' }],\r\n  }),\r\n});\n"})}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Carpeta: producttrack/productos"}),"\n",(0,i.jsx)(a.li,{children:"Formatos permitidos: jpg, png, jpeg, webp"}),"\n",(0,i.jsx)(a.li,{children:"Transformaci\xf3n: redimensiona a m\xe1ximo 500x500 sin recorte forzado"}),"\n"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h3,{id:"-almacenamiento-para-perfiles",children:"\ud83d\udc64 Almacenamiento para perfiles"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:"const storagePerfiles = new CloudinaryStorage({\r\n  cloudinary,\r\n  params: async () => ({\r\n    folder: 'producttrack/perfiles',\r\n    allowed_formats: ['jpg', 'png', 'jpeg', 'webp'],\r\n    transformation: [{ width: 500, height: 500, crop: 'limit' }],\r\n  }),\r\n});\n"})}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Carpeta: producttrack/perfiles"}),"\n",(0,i.jsx)(a.li,{children:"Formatos y transformaci\xf3n: igual que productos"}),"\n"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-exportaci\xf3n-de-middlewares",children:"\ud83d\ude80 Exportaci\xf3n de middlewares"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:"export const uploadPerfiles = multer({ storage: storagePerfiles });\r\nexport const uploadProductos = multer({ storage: storageProductos });\n"})}),"\n",(0,i.jsx)(a.p,{children:"Estos middlewares pueden ser usados directamente en rutas de Express para procesar subidas:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"uploadPerfiles: subir im\xe1genes a la carpeta perfiles"}),"\n",(0,i.jsx)(a.li,{children:"uploadProductos: subir im\xe1genes a la carpeta productos"}),"\n"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-ejemplo-de-uso-en-rutas",children:"\u2705 Ejemplo de uso en rutas"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-ts",children:'import { uploadProductos, uploadPerfiles } from "../middleware/allCloudinaryUploads";\r\n\r\nrouter.post("/subir/producto", uploadProductos.single("imagen"), controlador.guardarProducto);\r\nrouter.post("/subir/perfil", uploadPerfiles.single("avatar"), controlador.guardarPerfil);\n'})}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-recomendaciones",children:"\ud83d\udd10 Recomendaciones"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Aseg\xfarate de tener definidas las variables de entorno: CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY, CLOUDINARY_API_SECRET."}),"\n",(0,i.jsx)(a.li,{children:"Incluye validaciones de tipo MIME si deseas m\xe1s seguridad."}),"\n"]})]})}function u(e={}){const{wrapper:a}={...(0,d.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}}}]);