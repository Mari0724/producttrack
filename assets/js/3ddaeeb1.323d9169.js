"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7954],{4998:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"backend/services/norificaciones/productoVencidoService","title":"Servicio - Notificar Producto Vencido","description":"Este servicio env\xeda notificaciones a usuarios o miembros de una empresa cuando uno o m\xe1s productos han superado su fecha de vencimiento.","source":"@site/docs/backend/services/norificaciones/productoVencido.service.md","sourceDirName":"backend/services/norificaciones","slug":"/backend/services/norificaciones/productoVencidoService","permalink":"/producttrack/docs/backend/services/norificaciones/productoVencidoService","draft":false,"unlisted":false,"editUrl":"https://github.com/Mari0724/producttrack/docs/backend/services/norificaciones/productoVencido.service.md","tags":[],"version":"current","frontMatter":{"id":"productoVencidoService","title":"Servicio - Notificar Producto Vencido","sidebar_label":"Producto Vencido"},"sidebar":"tutorialSidebar","previous":{"title":"Marcar Leida","permalink":"/producttrack/docs/backend/services/norificaciones/marcarLeidaService"},"next":{"title":"Reposicion","permalink":"/producttrack/docs/backend/services/norificaciones/reposicionService"}}');var c=n(4848),s=n(8453);const o={id:"productoVencidoService",title:"Servicio - Notificar Producto Vencido",sidebar_label:"Producto Vencido"},a="productoVencido.service",d={},t=[{value:"\ud83d\udd0d Ubicaci\xf3n",id:"-ubicaci\xf3n",level:2},{value:"\ud83d\udce6 Dependencias utilizadas",id:"-dependencias-utilizadas",level:2},{value:"\ud83d\udd0d Descripci\xf3n",id:"-descripci\xf3n",level:2},{value:"\ud83d\udee0\ufe0f L\xf3gica clave",id:"\ufe0f-l\xf3gica-clave",level:2},{value:"\ud83d\udccc Par\xe1metros",id:"-par\xe1metros",level:2},{value:"\ud83d\udce4 Retorno",id:"-retorno",level:2},{value:"\ud83d\udcce Notas",id:"-notas",level:2}];function l(e){const i={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.header,{children:(0,c.jsx)(i.h1,{id:"productovencidoservice",children:"productoVencido.service"})}),"\n",(0,c.jsxs)(i.p,{children:["Este servicio ",(0,c.jsx)(i.strong,{children:"env\xeda notificaciones a usuarios o miembros de una empresa"})," cuando uno o m\xe1s productos han superado su ",(0,c.jsx)(i.strong,{children:"fecha de vencimiento"}),"."]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"-ubicaci\xf3n",children:"\ud83d\udd0d Ubicaci\xf3n"}),"\n",(0,c.jsx)(i.p,{children:(0,c.jsx)(i.code,{children:"src/services/notificaciones/productoVencido.service.ts"})}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"-dependencias-utilizadas",children:"\ud83d\udce6 Dependencias utilizadas"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-ts",children:"import prisma from '../../utils/prismaClient';\r\nimport { TipoNotificacion, productos as Producto } from '@prisma/client';\r\nimport { puedeNotificar } from '../../utils/notificaciones/preferenciasNotificaciones';\n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:(0,c.jsx)(i.code,{children:"prisma"})})," \u2192 Cliente Prisma para operaciones sobre la base de datos."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:(0,c.jsx)(i.code,{children:"TipoNotificacion"})})," \u2192 Enumeraci\xf3n de tipos de notificaci\xf3n disponible en el esquema de Prisma."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:(0,c.jsx)(i.code,{children:"Producto"})})," \u2192 Tipo generado por Prisma para la tabla ",(0,c.jsx)(i.code,{children:"productos"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:(0,c.jsx)(i.code,{children:"puedeNotificar"})})," \u2192 Valida si un usuario tiene activada la preferencia para un tipo de notificaci\xf3n."]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"-descripci\xf3n",children:"\ud83d\udd0d Descripci\xf3n"}),"\n",(0,c.jsxs)(i.p,{children:["La funci\xf3n ",(0,c.jsx)(i.code,{children:"notificarProductoVencido"}),":"]}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsxs)(i.li,{children:["Busca productos con fecha de vencimiento anterior a la fecha actual y que ",(0,c.jsx)(i.strong,{children:"no est\xe9n eliminados"})," (",(0,c.jsx)(i.code,{children:"eliminadoEn = null"}),")."]}),"\n",(0,c.jsx)(i.li,{children:"Puede recibir una lista espec\xedfica de productos para evaluar, o revisar todos en la base de datos."}),"\n",(0,c.jsx)(i.li,{children:"Genera un mensaje personalizado para cada producto vencido."}),"\n",(0,c.jsxs)(i.li,{children:["Env\xeda la notificaci\xf3n a:","\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"El propietario, si es un usuario individual."}),"\n",(0,c.jsx)(i.li,{children:"Todos los miembros de la empresa, si el propietario es empresarial."}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:["Respeta las ",(0,c.jsx)(i.strong,{children:"preferencias de notificaci\xf3n"})," antes de enviar."]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"\ufe0f-l\xf3gica-clave",children:"\ud83d\udee0\ufe0f L\xf3gica clave"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-ts",children:"// Filtrar productos vencidos\r\nfechaVencimiento < hoy && eliminadoEn == null\r\n\r\n// Diferenciar flujo seg\xfan tipo de usuario\r\nif (usuario.tipoUsuario === 'INDIVIDUAL') { ... }\r\nelse if (usuario.tipoUsuario === 'EMPRESARIAL') { ... }\r\n\r\n// Crear notificaci\xf3n en la BD\r\nawait prisma.notificaciones.create({ ... });\n"})}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"-par\xe1metros",children:"\ud83d\udccc Par\xe1metros"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Par\xe1metro"}),(0,c.jsx)(i.th,{children:"Tipo"}),(0,c.jsx)(i.th,{children:"Obligatorio"}),(0,c.jsx)(i.th,{children:"Descripci\xf3n"})]})}),(0,c.jsx)(i.tbody,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"productosOpcionales"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Producto[]"})}),(0,c.jsx)(i.td,{children:"No"}),(0,c.jsx)(i.td,{children:"Lista de productos a evaluar. Si no se pasa, se revisan todos los vencidos."})]})})]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"-retorno",children:"\ud83d\udce4 Retorno"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"Tipo:"})," ",(0,c.jsx)(i.code,{children:"Promise<void>"})]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"Efecto:"})," Inserta notificaciones en la base de datos para los usuarios correspondientes."]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.h2,{id:"-notas",children:"\ud83d\udcce Notas"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Solo se procesan productos con ",(0,c.jsx)(i.code,{children:"fechaVencimiento"})," anterior a la fecha actual y que no est\xe9n eliminados."]}),"\n",(0,c.jsxs)(i.li,{children:["Para usuarios ",(0,c.jsx)(i.strong,{children:"empresariales"}),", la notificaci\xf3n se env\xeda a todos los miembros asociados al ",(0,c.jsx)(i.code,{children:"empresaId"}),"."]}),"\n",(0,c.jsx)(i.li,{children:"El texto de la notificaci\xf3n incluye el nombre del producto y la fecha de vencimiento en formato legible."}),"\n",(0,c.jsxs)(i.li,{children:["Se respeta siempre la configuraci\xf3n de preferencias (",(0,c.jsx)(i.code,{children:"puedeNotificar"}),") antes de enviar."]}),"\n"]}),"\n",(0,c.jsx)(i.hr,{})]})}function u(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var r=n(6540);const c={},s=r.createContext(c);function o(e){const i=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),r.createElement(s.Provider,{value:i},e.children)}}}]);